import{w,r as a,i as C,h as E,j as s,n as y}from"./index-DlcvTWOH.js";import{S as O}from"./Snackbar-z76ToobN.js";import{A as $}from"./Alert-D_RgXu2Q.js";import"./IconButton-eRt6TsSc.js";const D="https://silitzer-pharma.onrender.com",U=()=>{const{offerId:n}=w(),[i,m]=a.useState([]),[h,x]=a.useState(!0),[c,p]=a.useState(null),[j,l]=a.useState(!1),[r,N]=a.useState({}),S=C(),g=E();a.useEffect(()=>{(async()=>{try{const t=await fetch(`${D}/distributor/offer/products?offerId=${n}`,{credentials:"include"});if(!t.ok)throw new Error("Failed to fetch offer products");const o=await t.json();m(o.products||[]),N(o.offer||{})}catch(t){p(t.message)}finally{x(!1)}})()},[n]);const k=e=>{e.inStock&&(g(y({...e,quantity:1,offers:e.offers,image:e.imageUrl})),l(!0))},d=(e,t)=>{t!=="clickaway"&&l(!1)},f=e=>{S(`/distributor/product/${e}`)},v=e=>{if(!e)return"";const t=new Date(e),o=t.getDate().toString().padStart(2,"0"),P=(t.getMonth()+1).toString().padStart(2,"0"),b=t.getFullYear();return`${o}/${P}/${b}`},u=r.validTill?new Date(r.validTill)<new Date:!1;return s.jsxs("div",{className:"offer-products-container",children:[s.jsx("h2",{className:"title",children:"Products under Offer"}),r.description&&s.jsxs("p",{className:`offer-description ${u?"expired-offer":""}`,children:[r.description,s.jsxs("span",{className:"valid-till",children:[" (Valid Till: ",v(r.validTill),")"]}),u&&s.jsx("span",{className:"expired-label",children:"Expired"})]}),h?s.jsx("p",{className:"info-text",children:"Loading products..."}):c?s.jsxs("p",{className:"error-text",children:["Error: ",c]}):i.length===0?s.jsx("p",{className:"info-text",children:"No products found for this offer."}):s.jsx("div",{className:"product-grid",children:i.map(e=>s.jsxs("div",{className:"product-card",children:[s.jsx("img",{src:e.imageUrl||null,alt:e.productName,className:"product-image",onClick:()=>f(e._id)}),s.jsx("h3",{className:"product-name",title:e.productName,onClick:()=>f(e._id),children:e.productName}),e.unitsPerBox!==void 0&&e.unitsPerBox!==null&&e.unitsPerBox!==""&&s.jsxs("p",{className:"units-info",children:["Units per Box: ",e.unitsPerBox]}),s.jsx("div",{className:`stock ${e.inStock?"in":"out"}`,children:e.inStock?"In Stock":"Out of Stock"}),s.jsx("button",{className:"add-to-cart-btn",disabled:!e.inStock,onClick:()=>k(e),children:"Add to Cart"})]},e._id))}),s.jsx(O,{open:j,autoHideDuration:3e3,onClose:d,anchorOrigin:{vertical:"bottom",horizontal:"center"},children:s.jsx($,{onClose:d,severity:"success",sx:{width:"100%"},children:"Product added to cart!"})})]})};export{U as default};
