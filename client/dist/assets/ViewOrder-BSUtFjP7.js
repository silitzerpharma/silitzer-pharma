import{f as a,j as e,w as P,i as E,r as n,C as H,T as c,U as I,B as f}from"./index-DlcvTWOH.js";import{A as M}from"./Alert-D_RgXu2Q.js";import{T as z,a as B,b as C,c as i,d as R}from"./TableRow-DuThesGT.js";import{D as V,a as F,b as U,c as $}from"./DialogTitle-DGL2koDV.js";import{F as _}from"./FormControlLabel-BjTYelCt.js";import{C as q}from"./Checkbox-COSfp9Jj.js";import"./IconButton-eRt6TsSc.js";import"./useFormControl-CXPDb4oN.js";import"./SwitchBase--2o_48n6.js";import"./useControlled-CHhDBfC_.js";const J=a([e.jsx("path",{d:"M11.99 2C6.47 2 2 6.48 2 12s4.47 10 9.99 10C17.52 22 22 17.52 22 12S17.52 2 11.99 2M12 20c-4.42 0-8-3.58-8-8s3.58-8 8-8 8 3.58 8 8-3.58 8-8 8"},"0"),e.jsx("path",{d:"M12.5 7H11v6l5.25 3.15.75-1.23-4.5-2.67z"},"1")]),Q=a(e.jsx("path",{d:"M19 6h-2c0-2.76-2.24-5-5-5S7 3.24 7 6H5c-1.1 0-1.99.9-1.99 2L3 20c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2V8c0-1.1-.9-2-2-2m-7-3c1.66 0 3 1.34 3 3H9c0-1.66 1.34-3 3-3m0 10c-2.76 0-5-2.24-5-5h2c0 1.66 1.34 3 3 3s3-1.34 3-3h2c0 2.76-2.24 5-5 5"})),Y=a(e.jsx("path",{d:"M19 14V6c0-1.1-.9-2-2-2H3c-1.1 0-2 .9-2 2v8c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2m-9-1c-1.66 0-3-1.34-3-3s1.34-3 3-3 3 1.34 3 3-1.34 3-3 3m13-6v11c0 1.1-.9 2-2 2H4v-2h17V7z"})),G=a(e.jsx("path",{d:"M12 12c2.21 0 4-1.79 4-4s-1.79-4-4-4-4 1.79-4 4 1.79 4 4 4m0 2c-2.67 0-8 1.34-8 4v2h16v-2c0-2.66-5.33-4-8-4"})),K=a(e.jsx("path",{d:"M18 17H6v-2h12zm0-4H6v-2h12zm0-4H6V7h12zM3 22l1.5-1.5L6 22l1.5-1.5L9 22l1.5-1.5L12 22l1.5-1.5L15 22l1.5-1.5L18 22l1.5-1.5L21 22V2l-1.5 1.5L18 2l-1.5 1.5L15 2l-1.5 1.5L12 2l-1.5 1.5L9 2 7.5 3.5 6 2 4.5 3.5 3 2z"})),b="https://silitzer-pharma.onrender.com",oe=()=>{var p,v,g;const l=P(),d=E(),[s,y]=n.useState(null),[N,L]=n.useState(!0),[j,S]=n.useState(null),[k,h]=n.useState(!1),[u,x]=n.useState(!1);n.useEffect(()=>{(async()=>{try{const t=await fetch(`${b}/admin/order?id=${l.id}`,{credentials:"include"});if(!t.ok)throw new Error("Failed to fetch order details");const o=await t.json();y(o.order)}catch(t){S(t.message)}finally{L(!1)}})()},[l.id]);const w=()=>{d(-1)},D=()=>{d(`/admin/order/approve/${l.id}`)},A=()=>{h(!0)},O=async()=>{try{(await fetch(`${b}/admin/cancelorder`,{method:"DELETE",headers:{"Content-Type":"application/json"},credentials:"include",body:JSON.stringify({orderId:s._id,updateStock:u})})).ok?(alert("Order cancelled"),d(-1)):alert("Failed to cancel order")}catch{alert("Error cancelling order")}finally{h(!1),x(!1)}},m=()=>{h(!1),x(!1)},T=["cancel","canceled","Delivered","Canceled","Cancel"].includes(s==null?void 0:s.status);return N?e.jsx("div",{className:"view-order loading",children:e.jsx(H,{})}):j?e.jsx("div",{className:"view-order error",children:e.jsxs(M,{severity:"error",children:["Error: ",j]})}):s?e.jsxs("div",{className:"view-order",children:[e.jsxs(c,{variant:"h4",gutterBottom:!0,color:"primary",children:[e.jsx(K,{sx:{verticalAlign:"middle",marginRight:"0.5rem"}}),"Order Details",(s==null?void 0:s.status)==="Pending"&&e.jsx("button",{onClick:D,className:"approve-order-btn",children:"Approve Order"}),e.jsx("button",{onClick:w,className:"black-btn",children:e.jsx(I,{sx:{fontSize:30}})})]}),e.jsxs("section",{className:"section grid-two",children:[e.jsxs("div",{children:[e.jsx(J,{})," ",e.jsx("strong",{children:"Order Date:"})," ",new Date(s.orderDate).toLocaleString()]}),e.jsxs("div",{children:[e.jsx(Q,{})," ",e.jsx("strong",{children:"Status:"})," ",s.status]}),e.jsxs("div",{children:[e.jsx(Y,{})," ",e.jsx("strong",{children:"Payment:"})," ",s.paymentStatus]}),e.jsxs("div",{children:[e.jsx(G,{})," ",e.jsx("strong",{children:"Distributor:"})," ",((p=s.distributor)==null?void 0:p.username)||"N/A"]}),e.jsxs("div",{children:[e.jsx("strong",{children:"Subtotal:"})," ₹",s.subtotal]}),e.jsxs("div",{children:[e.jsx("strong",{children:"Net Amount:"})," ₹",s.netAmount]}),e.jsxs("div",{children:[e.jsx("strong",{children:"Received Amount:"})," ₹",s.receivedAmount]}),e.jsxs("div",{children:[e.jsx("strong",{children:"Total Purchase Cost:"})," ₹",s.totalPurchaseCost]})]}),e.jsxs("section",{className:"section",children:[e.jsx(c,{variant:"h6",children:"Instructions"}),e.jsx("p",{children:s.orderInstructions||"None"})]}),e.jsxs("section",{className:"section",children:[e.jsx(c,{variant:"h6",children:"Product List"}),e.jsxs(z,{children:[e.jsx(B,{children:e.jsxs(C,{children:[e.jsx(i,{children:"Product Name"}),e.jsx(i,{children:"Quantity"})]})}),e.jsx(R,{children:(v=s.productList)==null?void 0:v.map((r,t)=>{var o;return e.jsxs(C,{children:[e.jsx(i,{children:((o=r.productId)==null?void 0:o.productName)||"Unnamed Product"}),e.jsx(i,{children:r.quantity})]},t)})})]})]}),e.jsxs("section",{className:"section",children:[e.jsx(c,{variant:"h6",children:"Status History"}),e.jsx("ul",{children:(g=s.statusHistory)==null?void 0:g.map((r,t)=>e.jsxs("li",{children:[e.jsx("strong",{children:r.status})," at ",new Date(r.changedAt).toLocaleString()]},t))})]}),(s==null?void 0:s.status)!=="Pending"&&(s==null?void 0:s.status)!=="Cancelled"&&e.jsx("div",{className:"viewproduct-ftb-btn",children:e.jsx("button",{className:"cancel-order-btn",onClick:A,disabled:T,children:"Cancel Order"})}),e.jsxs(V,{open:k,onClose:m,children:[e.jsx(F,{children:"Cancel Order"}),e.jsxs(U,{children:[e.jsx(c,{children:"Are you sure you want to cancel this order?"}),e.jsx(_,{control:e.jsx(q,{checked:u,onChange:r=>x(r.target.checked),color:"primary"}),label:"Do you want to restock the canceled items?"})]}),e.jsxs($,{children:[e.jsx(f,{onClick:m,color:"secondary",children:"No"}),e.jsx(f,{onClick:O,color:"primary",autoFocus:!0,children:"Yes, Cancel"})]})]})]}):e.jsx("div",{className:"view-order",children:"No order found."})};export{oe as default};
