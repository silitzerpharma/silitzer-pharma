import{f as M,j as e,r as a,Y as k,T as j,X as z,B as L,C as U,O as _,Q as G,S as H}from"./index-DlcvTWOH.js";import{I as Y}from"./IconButton-eRt6TsSc.js";import{D as I,a as P,b as A,c as $}from"./DialogTitle-DGL2koDV.js";import{T as D}from"./TextField-Doo77Nta.js";import"./Select-BpVlYiRl.js";import"./useControlled-CHhDBfC_.js";import"./useFormControl-CXPDb4oN.js";import"./InputLabel-Bd8_Eb26.js";const J=M(e.jsx("path",{d:"M19 13h-6v6h-2v-6H5v-2h6V5h2v6h6z"})),B="https://silitzer-pharma.onrender.com",K=()=>{const[n,i]=a.useState(!1),[m,p]=a.useState(""),[r,g]=a.useState(""),[l,f]=a.useState(""),[c,o]=a.useState(""),[u,R]=a.useState([]),[E,S]=a.useState(!1),[h,y]=a.useState(!1),[b,s]=a.useState(""),[q,x]=a.useState(!1),N=async()=>{S(!0),s("");try{const t=await fetch(`${B}/employee/leaverequest`,{method:"GET",credentials:"include"});if(!t.ok)throw new Error("Failed to fetch leave requests");const d=await t.json();R(d)}catch(t){s(t.message||"Error fetching leave requests")}finally{S(!1)}};a.useEffect(()=>{N()},[]);const F=()=>i(!0),w=()=>{p(""),g(""),f(""),o(""),i(!1),s("")},T=()=>x(!1),O=async()=>{if(!m||!r||!l){s("Please fill all required fields.");return}const t=new Date;t.setHours(0,0,0,0);const d=new Date(r),v=new Date(l);if(d<t){s("Start date cannot be in the past.");return}if(v<t){s("End date cannot be in the past.");return}if(v<d){s("End date cannot be before start date.");return}y(!0),s("");try{const C=await fetch(`${B}/employee/leaverequest`,{method:"POST",headers:{"Content-Type":"application/json"},credentials:"include",body:JSON.stringify({leaveType:m,startDate:r,endDate:l,reason:c})});if(!C.ok){const W=await C.json();throw new Error(W.message||"Failed to submit leave request")}await N(),w(),x(!0)}catch(C){s(C.message||"Error submitting leave request")}finally{y(!1)}};return e.jsxs(k,{className:"leave-container",children:[e.jsxs(k,{className:"header",children:[e.jsx(j,{variant:"h6",children:"Leave Requests"}),e.jsx(Y,{color:"primary",onClick:F,children:e.jsx(J,{})})]}),e.jsxs(I,{open:n,onClose:w,fullWidth:!0,maxWidth:"xs",children:[e.jsx(P,{children:"Request Leave"}),e.jsxs(A,{children:[e.jsx(D,{label:"Leave Type",select:!0,fullWidth:!0,margin:"dense",required:!0,value:m,onChange:t=>p(t.target.value),children:["Casual","Sick","Unpaid","Earned"].map(t=>e.jsx(z,{value:t,children:t},t))}),e.jsx(D,{label:"Start Date",type:"date",fullWidth:!0,margin:"dense",InputLabelProps:{shrink:!0},value:r,onChange:t=>g(t.target.value),required:!0}),e.jsx(D,{label:"End Date",type:"date",fullWidth:!0,margin:"dense",InputLabelProps:{shrink:!0},value:l,onChange:t=>f(t.target.value),required:!0}),e.jsx(D,{label:"Reason",multiline:!0,rows:3,fullWidth:!0,margin:"dense",value:c,onChange:t=>o(t.target.value)}),b&&e.jsx(j,{color:"error",variant:"body2",mt:1,children:b})]}),e.jsxs($,{children:[e.jsx(L,{onClick:w,color:"inherit",disabled:h,children:"Cancel"}),e.jsx(L,{onClick:O,variant:"contained",disabled:h,children:h?"Submitting...":"Submit"})]})]}),e.jsxs(I,{open:q,onClose:T,maxWidth:"xs",children:[e.jsx(P,{children:"Success"}),e.jsx(A,{children:e.jsx(j,{children:"Your leave request has been sent successfully."})}),e.jsx($,{children:e.jsx(L,{onClick:T,autoFocus:!0,children:"OK"})})]}),e.jsxs(k,{className:"request-list",mt:2,children:[e.jsx(j,{variant:"subtitle1",gutterBottom:!0,children:"My Leave Requests"}),E?e.jsx(k,{display:"flex",justifyContent:"center",mt:2,children:e.jsx(U,{size:24})}):u.length===0?e.jsx(j,{variant:"body2",color:"text.secondary",children:"No leave requests yet."}):e.jsx(_,{dense:!0,children:u.map(t=>{var d,v;return e.jsx(G,{divider:!0,children:e.jsx(H,{primary:`${t.leaveType} (${(d=t.startDate)==null?void 0:d.slice(0,10)} to ${(v=t.endDate)==null?void 0:v.slice(0,10)})`,secondary:`Status: ${t.status} | Applied: ${new Date(t.appliedAt).toLocaleDateString()}`})},t._id)})})]})]})},Q=["","Pending","Approved","Rejected"],V="https://silitzer-pharma.onrender.com",X=()=>{const[n,i]=a.useState([]),[m,p]=a.useState(!1),[r,g]=a.useState(""),[l,f]=a.useState(""),[c,o]=a.useState(1),[u,R]=a.useState(1),E=5,S=async()=>{p(!0);try{const s=new URL(`${V}/employee/task/cancelrequests`);s.searchParams.append("page",c),s.searchParams.append("limit",E),r.trim()!==""&&s.searchParams.append("q",r.trim()),l&&s.searchParams.append("status",l);const q=await fetch(s.toString(),{credentials:"include"});if(!q.ok)throw new Error("Failed to fetch cancel task requests");const x=await q.json();i(x.data),R(x.totalPages)}catch(s){console.error("Error fetching cancel task requests:",s),i([])}finally{p(!1)}};a.useEffect(()=>{S()},[c,r,l]);const h=s=>s?new Date(s).toLocaleDateString("en-GB"):"-",y=s=>{g(s.target.value),o(1)},b=s=>{f(s.target.value),o(1)};return e.jsxs("div",{className:"cancel-task-requests",children:[e.jsx("input",{type:"text",placeholder:"Search by Request ID or Task ID",value:r,onChange:y,className:"search-input"}),e.jsxs("select",{className:"status-filter",value:l,onChange:b,children:[e.jsx("option",{value:"",children:"All Statuses"}),Q.filter(s=>s!=="").map(s=>e.jsx("option",{value:s,children:s},s))]}),m?e.jsx("div",{className:"spinner",children:"Loading..."}):n.length===0?e.jsx("div",{className:"no-data",children:"No cancel task requests found."}):e.jsxs(e.Fragment,{children:[n.map(s=>e.jsxs("div",{className:"cancel-task-card",children:[e.jsxs("div",{children:[e.jsx("strong",{children:"Request ID:"})," ",s.requestId]}),e.jsxs("div",{children:[e.jsx("strong",{children:"Task ID:"})," ",s.taskId]}),e.jsxs("div",{children:[e.jsx("strong",{children:"Reason:"})," ",s.reason||"-"]}),e.jsxs("div",{children:[e.jsx("strong",{children:"Status:"})," ",s.status]}),e.jsxs("div",{children:[e.jsx("strong",{children:"Requested At:"})," ",h(s.requestedAt)]}),e.jsxs("div",{children:[e.jsx("strong",{children:"Reviewed At:"})," ",h(s.reviewedAt)]})]},s.requestId)),e.jsxs("div",{className:"pagination",children:[e.jsx("button",{disabled:c<=1,onClick:()=>o(s=>Math.max(s-1,1)),children:"Prev"}),[...Array(u).keys()].map(s=>e.jsx("button",{className:c===s+1?"active":"",onClick:()=>o(s+1),children:s+1},s+1)),e.jsx("button",{disabled:c>=u,onClick:()=>o(s=>Math.min(s+1,u)),children:"Next"})]})]})]})},ie=()=>{const[n,i]=a.useState("leave");return e.jsxs("div",{className:"EmployeeRequests-div",children:[e.jsxs("div",{className:"EmployeeRequests-nav",children:[e.jsx("div",{className:`employee-nav-link ${n==="leave"?"active":""}`,onClick:()=>i("leave"),children:"Leave Requests"}),e.jsx("div",{className:`employee-nav-link ${n==="cancel"?"active":""}`,onClick:()=>i("cancel"),children:"Cancel Task Requests"})]}),e.jsxs("div",{className:"EmployeeRequests-container",children:[n==="leave"&&e.jsx(K,{}),n==="cancel"&&e.jsx(X,{})]})]})};export{ie as default};
