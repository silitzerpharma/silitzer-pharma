import{f as W,j as e,r as t,L as M,y as l,a4 as Y}from"./index-DlcvTWOH.js";import{s as K,e as Q,a as X,b as Z,i as _,c as ee,d as se}from"./isSameMonth-Bh9_FtD7.js";import{s as te,f as O}from"./format-CfEi8zQK.js";const V=W(e.jsx("path",{d:"m18 22-.01-6L14 12l3.99-4.01L18 2H6v6l4 4-4 3.99V22zM8 7.5V4h8v3.5l-4 4z"})),R="https://silitzer-pharma.onrender.com",ae=({isActive:r})=>{const[i,p]=t.useState([]),[S,m]=t.useState(!1),[d,x]=t.useState(""),[f,j]=t.useState(""),[u,h]=t.useState(""),[T,C]=t.useState(!1),[A,N]=t.useState(!1),[w,k]=t.useState(""),[L,o]=t.useState(""),[y,v]=t.useState(!1),[b,g]=t.useState(!1),[F,q]=t.useState(!1),E=()=>C(s=>!s);t.useEffect(()=>{(async()=>{try{v(!0);const a=await fetch(`${R}/employee/task/today`,{credentials:"include"});if(!a.ok)throw new Error("Failed to fetch tasks");const n=await a.json();p(n)}catch{l.error("Error fetching today's tasks")}finally{v(!1)}})()},[T]);const z=(s,a,n)=>{a!==n&&(j(s),h(a),a==="Complete"?m(!0):P({task_id:s,status:a}))},P=async({task_id:s,status:a})=>{const n=()=>{x(""),h(""),j(""),g(!1)};if(!s||!a){l.error("Missing status or task ID."),n();return}if(g(!0),a==="Complete"){if(!navigator.geolocation){l.error("Geolocation is not supported."),n();return}navigator.geolocation.getCurrentPosition(async c=>{const D={latitude:c.coords.latitude,longitude:c.coords.longitude};try{if(!(await fetch(`${R}/employee/task/update-status`,{method:"POST",headers:{"Content-Type":"application/json"},credentials:"include",body:JSON.stringify({status:a,location:D,task_id:s,note:d})})).ok)throw new Error("Failed to update status.");E(),l.success("Status updated successfully.")}catch(I){l.error("Error updating status: "+I.message)}finally{n()}},()=>{l.error("Error getting location. Status not updated."),n()})}else try{if(!(await fetch(`${R}/employee/task/update-status`,{method:"POST",headers:{"Content-Type":"application/json"},credentials:"include",body:JSON.stringify({status:a,task_id:s})})).ok)throw new Error("Failed to update status.");E(),l.success("Status updated successfully.")}catch(c){l.error("Error updating status: "+c.message)}finally{n()}},G=()=>{P({task_id:f,status:u}),m(!1)},U=()=>{m(!1),x("")},H=s=>{o(s),N(!0),k("")},$=()=>{N(!1),k(""),o("")},J=async()=>{q(!0);try{if(!(await fetch(`${R}/employee/task/cancel`,{method:"POST",headers:{"Content-Type":"application/json"},credentials:"include",body:JSON.stringify({taskId:L,reason:w})})).ok)throw new Error("Failed to submit cancel request");l.success("Cancel request submitted successfully."),$(),E()}catch(s){l.error("Error submitting cancel request: "+s.message)}finally{q(!1)}};return y||b||F?e.jsx(M,{message:"Processing..."}):e.jsxs("div",{className:"tasks-list",children:[i.map((s,a)=>e.jsxs("div",{className:"task-card",children:[e.jsx("div",{className:"task-title",children:s.title}),e.jsxs("div",{className:"task-meta",children:[e.jsx("span",{children:s.address||"-"})," ·"," "]}),e.jsx("div",{className:"task-desc",children:s.description}),e.jsxs("div",{className:`task-status ${s.status.toLowerCase().replace(" ","-")}`,children:["Status: ",s.status,e.jsx("br",{}),e.jsxs("span",{children:["AssignDate: ",new Date(s.assignDate).toLocaleDateString("en-GB")]})," ",e.jsxs("span",{children:["StartDate: ",new Date(s.startDate).toLocaleDateString("en-GB")]}),e.jsx("br",{}),(()=>{const n=new Date(s.dueDate),c=new Date;n.setHours(0,0,0,0),c.setHours(0,0,0,0);const D=n.getTime()===c.getTime();return e.jsxs("span",{style:{color:D?"red":"inherit"},children:["DueDate: ",n.toLocaleDateString("en-GB"),D&&e.jsx(V,{style:{verticalAlign:"middle",marginLeft:4}})]})})()]}),r&&e.jsxs(e.Fragment,{children:[e.jsxs("select",{className:"status-select",value:"",onChange:n=>z(s.taskId,n.target.value,s.status),children:[e.jsx("option",{value:"",disabled:!0,children:"Update status"}),e.jsx("option",{value:"Ongoing",children:"Ongoing"}),e.jsx("option",{value:"Complete",children:"Complete"})]}),e.jsx("button",{onClick:()=>H(s.taskId),className:"cancel-request-button",children:"Request to Cancel"})]}),e.jsxs("div",{className:"priority-field",children:[e.jsx("strong",{children:"Priority:"})," ",s.priority]})]},s.taskId||a)),S&&e.jsx("div",{className:"modal-overlay",children:e.jsxs("div",{className:"modal-dialog",children:[e.jsx("h3",{children:"Task Completion Note"}),e.jsx("textarea",{placeholder:"Enter note about task completion...",value:d,onChange:s=>x(s.target.value),rows:4}),e.jsxs("div",{className:"modal-buttons",children:[e.jsx("button",{onClick:U,children:"Cancel"}),e.jsx("button",{onClick:G,disabled:!d.trim(),children:"Submit"})]})]})}),A&&e.jsx("div",{className:"cancel-modal-overlay",children:e.jsxs("div",{className:"cancel-modal-dialog",children:[e.jsx("h3",{children:"Request to Cancel Task"}),e.jsx("textarea",{placeholder:"Optional: Enter reason for cancel request",value:w,onChange:s=>k(s.target.value),rows:4}),e.jsxs("div",{className:"modal-buttons",children:[e.jsx("button",{onClick:$,children:"Cancel"}),e.jsx("button",{onClick:J,children:"Submit Request"})]})]})})]})},ne="https://silitzer-pharma.onrender.com",oe=({isActive:r})=>{const[i,p]=t.useState({title:"",description:"",status:"Ongoing",address:"",notes:""}),[S,m]=t.useState(!1),d=f=>{const{name:j,value:u}=f.target;p(h=>({...h,[j]:u}))},x=async f=>{f.preventDefault();const j=async u=>{try{m(!0);const h={...i,...u&&{location:u}},T=await fetch(`${ne}/employee/task/add`,{method:"POST",credentials:"include",headers:{"Content-Type":"application/json"},body:JSON.stringify(h)});if(!T.ok)throw new Error("Failed to submit task");const C=await T.json();l.success("Task added successfully!"),p({title:"",description:"",status:"Ongoing",address:"",notes:""})}catch(h){console.error("Error submitting task:",h),l.error("Error submitting task. Please try again.")}finally{m(!1)}};if(i.status==="Completed"){if(!navigator.geolocation){l.error("Geolocation is not supported by your browser.");return}navigator.geolocation.getCurrentPosition(u=>{const h={latitude:u.coords.latitude,longitude:u.coords.longitude};j(h)},u=>{console.error("Geolocation error:",u),l.error("Could not get your location. Task not added.")})}else j(null)};return r===!1?e.jsx("p",{children:"To add Task You need to Active"}):S?e.jsx(M,{message:"Adding Task..."}):e.jsxs("div",{className:"add-task-form",children:[e.jsx("h2",{children:"Add New Task"}),e.jsxs("form",{onSubmit:x,children:[e.jsxs("label",{children:["Title:",e.jsx("input",{name:"title",value:i.title,onChange:d,required:!0})]}),e.jsxs("label",{children:["Description:",e.jsx("textarea",{name:"description",value:i.description,onChange:d,required:!0})]}),e.jsxs("label",{children:["Status:",e.jsxs("select",{name:"status",value:i.status,onChange:d,children:[e.jsx("option",{value:"Ongoing",children:"Ongoing"}),e.jsx("option",{value:"Complete",children:"Completed"})]})]}),e.jsxs("label",{children:["Address:",e.jsx("input",{name:"address",value:i.address,onChange:d})]}),e.jsxs("label",{children:["Notes:",e.jsx("textarea",{name:"notes",value:i.notes,onChange:d})]}),e.jsx("button",{type:"submit",children:"Add Task"})]})]})};function re({task:r,onClose:i}){return e.jsx("div",{style:le,children:e.jsxs("div",{style:ie,children:[e.jsx("button",{onClick:i,style:ce,children:"✕"}),e.jsx("h2",{style:de,children:r.title}),e.jsxs("div",{style:ue,children:[e.jsxs("p",{children:[e.jsx("strong",{children:"Description:"})," ",r.description||"No description"]}),e.jsxs("p",{children:[e.jsx("strong",{children:"Status:"})," ",r.status]}),e.jsxs("p",{children:[e.jsx("strong",{children:"Priority:"})," ",r.priority]}),e.jsxs("p",{children:[e.jsx("strong",{children:"Start Date:"})," ",new Date(r.startDate).toLocaleString()]}),e.jsxs("p",{children:[e.jsx("strong",{children:"Due Date:"})," ",r.dueDate?new Date(r.dueDate).toLocaleString():"N/A"]})]})]})})}const le={position:"fixed",top:0,left:0,right:0,bottom:0,backgroundColor:"rgba(0,0,0,0.5)",display:"flex",justifyContent:"center",alignItems:"center",zIndex:1e3,padding:"10px"},ie={position:"relative",backgroundColor:"#fff",padding:"16px 20px",borderRadius:"12px",width:"100%",maxWidth:"400px",maxHeight:"80vh",overflowY:"auto",boxShadow:"0 4px 20px rgba(0,0,0,0.1)"},ce={position:"absolute",top:10,right:10,background:"transparent",border:"none",fontSize:"20px",fontWeight:"bold",color:"#555",cursor:"pointer"},de={marginBottom:"12px",fontSize:"20px",textAlign:"center",color:"#333"},ue={fontSize:"14px",color:"#444",lineHeight:1.5};function he(){const[r,i]=t.useState(new Date),[p,S]=t.useState([]),[m,d]=t.useState([]),[x,f]=t.useState(null),[j,u]=t.useState(!1),h=async o=>{const y=O(o,"yyyy-MM"),v=O(o,"yyyy-MM-dd");try{u(!0);const g=await(await fetch(`https://silitzer-pharma.onrender.com/employee/task/month?month=${y}&date=${v}`,{method:"GET",credentials:"include"})).json();S(Array.isArray(g.taskDays)?g.taskDays:[]),d(Array.isArray(g.tasksForDate)?g.tasksForDate:[])}catch(b){console.error("Failed to fetch task data",b),S([]),d([])}finally{u(!1)}};t.useEffect(()=>{h(r)},[r]);const T=t.useMemo(()=>new Set(p),[p]),C=K(r),A=Q(C),N=te(C),w=X(A),k=[];for(let o=N;o<=w;o=Z(o,1))k.push(o);const L=o=>{i(y=>se(y,o)),f(null)};return j?e.jsx(M,{message:"Loading Scheduled Tasks..."}):e.jsxs("div",{className:"scheduled-tasks",children:[e.jsxs("div",{className:"header",children:[e.jsx("button",{className:"nav-btn",onClick:()=>L(-1),children:"←"}),e.jsx("div",{className:"month-title",children:O(C,"MMMM yyyy")}),e.jsx("button",{className:"nav-btn",onClick:()=>L(1),children:"→"})]}),e.jsx("div",{className:"day-labels",children:["Sun","Mon","Tue","Wed","Thu","Fri","Sat"].map(o=>e.jsx("div",{className:"day-label",children:o},o))}),e.jsx("div",{className:"calendar",children:k.map(o=>{const y=O(o,"yyyy-MM-dd"),v=_(o,C),b=ee(o,r),g=T.has(y),F=["calendar-cell",!v&&"not-current-month",b&&"selected"].filter(Boolean).join(" ");return e.jsxs("div",{onClick:()=>v&&i(o),className:F,children:[O(o,"d"),g&&e.jsx("span",{className:`task-dot ${b?"dot-selected":""}`})]},y)})}),e.jsxs("div",{className:"task-list",children:[e.jsxs("div",{className:"task-title",children:["Tasks for ",O(r,"do MMM yyyy")]}),m.length===0?e.jsx("div",{className:"no-tasks",children:"No tasks scheduled"}):e.jsx("ul",{children:m.map((o,y)=>e.jsxs("li",{onClick:()=>f(o),children:[o.title,o.time&&e.jsxs("span",{children:["(",o.time,")"]})]},y))})]}),x&&e.jsx(re,{task:x,onClose:()=>f(null)})]})}const B="https://silitzer-pharma.onrender.com",ge=({isActive:r})=>{const[i,p]=t.useState([]),[S,m]=t.useState(!1),[d,x]=t.useState(""),[f,j]=t.useState(""),[u,h]=t.useState(""),[T,C]=t.useState(!1),[A,N]=t.useState(!1),[w,k]=t.useState(""),[L,o]=t.useState(""),[y,v]=t.useState(!0),[b,g]=t.useState(!1),[F,q]=t.useState(!1),E=()=>C(s=>!s);t.useEffect(()=>{(async()=>{v(!0);try{const a=await fetch(`${B}/employee/task/pending`,{credentials:"include"});if(!a.ok)throw new Error("Failed to fetch pending tasks");const n=await a.json();p(n)}catch(a){console.error("Error fetching pending tasks:",a)}finally{v(!1)}})()},[T]);const z=(s,a,n)=>{a!==n&&(j(s),h(a),a==="Complete"?m(!0):P({task_id:s,status:a}))},P=async({task_id:s,status:a})=>{const n=()=>{x(""),h(""),j("")};if(!s||!a){l.error("Missing status or task ID."),n();return}if(g(!0),a==="Complete"){if(!navigator.geolocation){l.error("Geolocation is not supported by your browser."),n(),g(!1);return}navigator.geolocation.getCurrentPosition(async c=>{const D={latitude:c.coords.latitude,longitude:c.coords.longitude};try{if(!(await fetch(`${B}/employee/task/update-status`,{method:"POST",headers:{"Content-Type":"application/json"},credentials:"include",body:JSON.stringify({status:a,location:D,task_id:s,note:d})})).ok)throw new Error("Failed to update status.");E(),l.success("Status updated successfully.")}catch(I){l.error("Error updating status: "+I.message)}finally{n(),g(!1)}},()=>{l.error("Error getting location. Status not updated."),n(),g(!1)})}else try{if(!(await fetch(`${B}/employee/task/update-status`,{method:"POST",headers:{"Content-Type":"application/json"},credentials:"include",body:JSON.stringify({status:a,task_id:s})})).ok)throw new Error("Failed to update status.");E(),l.success("Status updated successfully.")}catch(c){l.error("Error updating status: "+c.message)}finally{n(),g(!1)}},G=()=>{P({task_id:f,status:u}),m(!1)},U=()=>{m(!1),x("")},H=s=>{o(s),N(!0),k("")},$=()=>{N(!1),k(""),o("")},J=async()=>{q(!0);try{if(!(await fetch(`${B}/employee/task/cancel`,{method:"POST",headers:{"Content-Type":"application/json"},credentials:"include",body:JSON.stringify({taskId:L,reason:w})})).ok)throw new Error("Failed to submit cancel request");l.success("Cancel request submitted successfully."),$(),E()}catch(s){l.error("Error submitting cancel request: "+s.message)}finally{q(!1)}};return e.jsxs("div",{className:"tasks-list",children:[y?e.jsx(M,{message:"Loading pending tasks..."}):i.length===0?e.jsx("div",{className:"no-tasks-message",children:"No pending tasks."}):i.map((s,a)=>e.jsxs("div",{className:"task-card",children:[e.jsx("div",{className:"task-title",children:s.title}),e.jsxs("div",{className:"task-meta",children:[e.jsx("span",{children:s.address||"-"})," ·"," "]}),e.jsx("div",{className:"task-desc",children:s.description}),e.jsxs("div",{className:`task-status ${s.status.toLowerCase().replace(" ","-")}`,children:["Status: ",s.status,e.jsx("br",{}),e.jsxs("span",{children:["AssignDate:"," ",new Date(s.assignDate).toLocaleDateString("en-GB")]}),e.jsxs("span",{children:[" ","StartDate:"," ",new Date(s.startDate).toLocaleDateString("en-GB")]}),e.jsx("br",{}),(()=>{const n=new Date(s.dueDate),c=new Date;n.setHours(0,0,0,0),c.setHours(0,0,0,0);const D=n.getTime()===c.getTime();return e.jsxs("span",{style:{color:D?"red":"inherit"},children:["DueDate: ",n.toLocaleDateString("en-GB"),D&&e.jsx(V,{style:{verticalAlign:"middle",marginLeft:4}})]})})()]}),e.jsxs("div",{className:"priority-field",children:[e.jsx("strong",{children:"Priority:"})," ",s.priority]}),r&&e.jsxs("select",{className:"status-select",value:"",onChange:n=>z(s.taskId,n.target.value,s.status),children:[e.jsx("option",{value:"",disabled:!0,children:"Update status"}),e.jsx("option",{value:"Ongoing",children:"Ongoing"}),e.jsx("option",{value:"Complete",children:"Complete"})]}),e.jsx("button",{onClick:()=>H(s.taskId),className:"cancel-request-button",children:"Request to Cancel"})]},s.taskId||a)),b&&e.jsx("div",{style:{marginTop:"20px"},children:e.jsx(M,{message:"Updating task status...",fullPage:!1,size:40})}),S&&e.jsx("div",{className:"modal-overlay",children:e.jsxs("div",{className:"modal-dialog",children:[e.jsx("h3",{children:"Task Completion Note"}),e.jsx("textarea",{placeholder:"Enter note about task completion...",value:d,onChange:s=>x(s.target.value),rows:4}),e.jsxs("div",{className:"modal-buttons",children:[e.jsx("button",{onClick:U,children:"Cancel"}),e.jsx("button",{onClick:G,disabled:!d.trim(),children:"Submit"})]})]})}),A&&e.jsx("div",{className:"cancel-modal-overlay",children:e.jsx("div",{className:"cancel-modal-dialog",children:F?e.jsx(M,{message:"Submitting cancel request...",fullPage:!1,size:40}):e.jsxs(e.Fragment,{children:[e.jsx("h3",{children:"Request to Cancel Task"}),e.jsx("textarea",{placeholder:"Optional: Enter reason for cancel request",value:w,onChange:s=>k(s.target.value),rows:4}),e.jsxs("div",{className:"modal-buttons",children:[e.jsx("button",{onClick:$,children:"Cancel"}),e.jsx("button",{onClick:J,children:"Submit Request"})]})]})})})]})},je=()=>{const[r,i]=t.useState("today"),{isActive:p,setIsActive:S}=Y();return e.jsxs("div",{className:"Tasks",children:[e.jsxs("nav",{className:"tasks-nav",children:[e.jsx("div",{className:`tasks-nav-link ${r==="today"?"active":""}`,onClick:()=>i("today"),children:"Todys Tasks"}),e.jsx("div",{className:`tasks-nav-link ${r==="pending"?"active":""}`,onClick:()=>i("pending"),children:"Pending Tasks"}),e.jsx("div",{className:`tasks-nav-link ${r==="add"?"active":""}`,onClick:()=>i("add"),children:"Add Tasks"}),e.jsx("div",{className:`tasks-nav-link ${r==="history"?"active":""}`,onClick:()=>i("history"),children:"Scheduled Tasks"})]}),e.jsxs("div",{className:"tasks-container",children:[r==="today"&&e.jsx("div",{className:"todys-tasks",children:e.jsx(ae,{isActive:p})}),r==="add"&&e.jsx("div",{className:"add-tasks",children:e.jsx(oe,{isActive:p})}),r==="history"&&e.jsx("div",{className:"tasks-history",children:e.jsx(he,{})}),r==="pending"&&e.jsx("div",{className:"pending-tasks",children:e.jsx(ge,{isActive:p})})]})]})};export{je as default};
