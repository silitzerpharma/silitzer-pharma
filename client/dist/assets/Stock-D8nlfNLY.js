import{r as s,j as t,L as K,P as Q,T as Y,B as u,X as T}from"./index-DlcvTWOH.js";/* empty css              */import{T as Z}from"./TableContainer-CQmYnS7h.js";import{T as ee,a as te,b as N,c as o,d as se}from"./TableRow-DuThesGT.js";import{T as ae}from"./TableSortLabel-Csm9lG0A.js";import{T as oe}from"./TextField-Doo77Nta.js";import{T as ne}from"./TablePagination-C03NsVHS.js";import{D as re,a as ce,b as ie,c as le}from"./DialogTitle-DGL2koDV.js";import{F as de,I as ue}from"./InputLabel-Bd8_Eb26.js";import{S as ke}from"./Select-BpVlYiRl.js";import"./useFormControl-CXPDb4oN.js";import"./LastPage-DpFt_x2b.js";import"./IconButton-eRt6TsSc.js";import"./useControlled-CHhDBfC_.js";const j="https://silitzer-pharma.onrender.com",he=({refreshFlag:k,refreshProductList:d})=>{const[c,i]=s.useState(0),[h,I]=s.useState(10),[l,w]=s.useState("asc"),[n,D]=s.useState("productName"),[O,E]=s.useState([]),[F,$]=s.useState(0),[S,R]=s.useState(""),[B,x]=s.useState(!1),[L,f]=s.useState(null),[b,g]=s.useState(!0),[C,y]=s.useState(null),[v,m]=s.useState(""),[_,P]=s.useState(!1),U=(e,a)=>i(a),A=e=>{I(parseInt(e.target.value,10)),i(0)},M=e=>{w(n===e&&l==="asc"?"desc":"asc"),D(e)},z=[{id:"productName",label:"Product Name"},{id:"pendingOrderCount",label:"Pending Orders"},{id:"stock",label:"Stock"},{id:"stockNeeds",label:"Stock Needs"},{id:"inStock",label:"For Distributors"},{id:"manageStock",label:"Manage Stock"}];s.useEffect(()=>{(async()=>{try{P(!0);const r=await(await fetch(`${j}/admin/getstockdata?page=${c}&limit=${h}&sortBy=${n}&order=${l}&search=${S}`,{credentials:"include"})).json();E(r.products),$(r.totalCount)}catch(a){console.error("Error fetching stock data:",a)}finally{P(!1)}})()},[c,h,l,n,k,S]);const J=e=>{f(e),g(e.inStock),x(!0)},p=()=>{x(!1),f(null),g(!0)},V=e=>g(e.target.value),q=async()=>{try{(await fetch(`${j}/admin/updatestockstatus`,{method:"PUT",headers:{"Content-Type":"application/json"},credentials:"include",body:JSON.stringify({inStock:b,productId:L._id})})).ok?(d(),alert("Stock status updated successfully")):alert("Failed to update stock status")}catch{alert("Error updating stock status")}p()},H=e=>{y(e._id),m(e.stock.toString())},W=e=>m(e.target.value),X=async e=>{const a=parseInt(v,10);if(isNaN(a)||a<0){alert("Enter a valid non-negative stock value");return}try{const r=await fetch(`${j}/admin/updatestock`,{method:"PUT",headers:{"Content-Type":"application/json"},credentials:"include",body:JSON.stringify({newStock:a,productId:e,reason:"Manual update"})});if(r.ok)d(),alert("Stock updated successfully");else{const G=await r.json();alert(`Failed: ${G.msg||"Unknown error"}`)}}catch{alert("Error updating stock")}y(null),m("")};return _?t.jsx(K,{message:"Loading Stock..."}):t.jsxs("div",{className:"table",children:[t.jsx("div",{className:"table-filter",children:t.jsx("input",{type:"text",placeholder:"Search by Name",value:S,onChange:e=>{R(e.target.value),i(0)}})}),t.jsx(Z,{component:Q,className:"table-container",children:t.jsxs(ee,{children:[t.jsx(te,{children:t.jsx(N,{children:z.map(e=>t.jsx(o,{align:"center",sortDirection:n===e.id?l:!1,children:["productName","stock","inStock","pendingOrderCount","stockNeeds"].includes(e.id)?t.jsx(ae,{active:n===e.id,direction:n===e.id?l:"asc",onClick:()=>M(e.id),children:e.label}):e.label},e.id))})}),t.jsx(se,{children:O.map(e=>t.jsxs(N,{children:[t.jsx(o,{align:"center",children:e.productName}),t.jsx(o,{align:"center",children:e.pendingOrderCount}),t.jsx(o,{align:"center",children:C===e._id?t.jsx(oe,{value:v,onChange:W,type:"number",size:"small",inputProps:{min:0}}):e.stock}),t.jsx(o,{align:"center",children:e.stockNeeds}),t.jsx(o,{align:"center",style:{cursor:"pointer",color:"#1976d2"},onClick:()=>J(e),title:"Click to edit stock status for distributors",children:t.jsx(Y,{color:e.inStock?"green":"red",children:e.inStock?"In Stock":"Out of Stock"})}),t.jsx(o,{align:"center",children:C===e._id?t.jsx(u,{variant:"contained",color:"primary",onClick:()=>X(e._id),children:"Save Stock"}):t.jsx(u,{variant:"outlined",onClick:()=>H(e),children:"Update Stock"})})]},e._id))})]})}),t.jsx(ne,{component:"div",count:F,page:c,onPageChange:U,rowsPerPage:h,onRowsPerPageChange:A,rowsPerPageOptions:[5,10,25,50]}),t.jsxs(re,{open:B,onClose:p,children:[t.jsx(ce,{children:"For Distributors product stock"}),t.jsx(ie,{children:t.jsxs(de,{fullWidth:!0,margin:"dense",children:[t.jsx(ue,{id:"in-stock-label",children:"Stock Status"}),t.jsxs(ke,{labelId:"in-stock-label",value:b,label:"Stock Status",onChange:V,children:[t.jsx(T,{value:!0,children:"In Stock"}),t.jsx(T,{value:!1,children:"Out of Stock"})]})]})}),t.jsxs(le,{children:[t.jsx(u,{onClick:p,color:"secondary",children:"Cancel"}),t.jsx(u,{onClick:q,color:"primary",children:"Save"})]})]})]})},Ie=()=>{const[k,d]=s.useState(!1),c=()=>d(i=>!i);return t.jsxs("div",{className:"page",children:[t.jsx("div",{className:"page-title",children:"Stock"}),t.jsx(he,{refreshFlag:k,refreshProductList:c})]})};export{Ie as default};
