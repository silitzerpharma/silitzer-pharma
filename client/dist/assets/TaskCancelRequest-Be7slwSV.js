import{w as z,i as H,r as a,ac as J,j as e,U as K,C as Q,T as g,B as l}from"./index-DlcvTWOH.js";import{u as G}from"./index-0sQ3Nx8k.js";import{D as j,a as p,b as f,c as y}from"./DialogTitle-DGL2koDV.js";import{I as V}from"./IconButton-eRt6TsSc.js";import{D as T}from"./DialogContentText-BFDKx7jj.js";import{T as X}from"./TextField-Doo77Nta.js";import{f as u}from"./format-CfEi8zQK.js";import"./getThemeProps-DR8AxGiy.js";import"./Select-BpVlYiRl.js";import"./useControlled-CHhDBfC_.js";import"./useFormControl-CXPDb4oN.js";import"./InputLabel-Bd8_Eb26.js";const q="https://silitzer-pharma.onrender.com",de=()=>{var k,D,R,w,S,b;const{id:i}=z(),m=H(),[s,M]=a.useState(null),[A,E]=a.useState(!0),[O,C]=a.useState(!1),[B,c]=a.useState(!1),[r,F]=a.useState(null),[h,L]=a.useState(""),[P,x]=a.useState(!1),[I,N]=a.useState(""),$=J(),W=G($.breakpoints.down("sm"));a.useEffect(()=>{(async()=>{try{const o=await fetch(`${q}/admin/employee/taskcancelrequest?id=${i}`,{credentials:"include"});if(!o.ok)throw new Error(`HTTP error! Status: ${o.status}`);const _=await o.json();M(_)}catch(o){console.error("Failed to fetch task cancel request:",o)}finally{E(!1)}})()},[i]);const d=()=>m(-1),v=t=>{F(t),c(!0)},U=async()=>{if(s){C(!0);try{const t=await fetch(`${q}/admin/employee/taskcancelrequest/update`,{method:"POST",headers:{"Content-Type":"application/json"},credentials:"include",body:JSON.stringify({requestId:s._id,action:r,...r==="Rejected"&&{rejectionReason:h}})});if(!t.ok)throw new Error("Failed to update request status");const o=await t.json();N(o.message||"Request updated successfully"),x(!0),c(!1)}catch(t){console.error(t)}finally{C(!1)}}};return e.jsxs(e.Fragment,{children:[e.jsxs(j,{open:!0,onClose:d,maxWidth:"sm",fullWidth:!0,children:[e.jsxs(p,{children:["Task Cancel Request",e.jsx(V,{onClick:d,sx:{position:"absolute",right:16,top:16},children:e.jsx(K,{})})]}),e.jsx(f,{dividers:!0,children:A?e.jsx("div",{style:{textAlign:"center",padding:"40px 0"},children:e.jsx(Q,{})}):s?e.jsxs("div",{style:{display:"grid",gridTemplateColumns:W?"1fr":"1fr 1fr",gap:"16px 24px"},children:[e.jsx(n,{label:"Employee",value:(k=s.employee)==null?void 0:k.name}),e.jsx(n,{label:"Task Title",value:(D=s.task)==null?void 0:D.title}),e.jsx(n,{label:"Address",value:(R=s.task)==null?void 0:R.address}),e.jsx(n,{label:"Assign Date",value:u(new Date((w=s.task)==null?void 0:w.assignDate),"dd MMM yyyy")}),e.jsx(n,{label:"Start Date",value:u(new Date((S=s.task)==null?void 0:S.startDate),"dd MMM yyyy")}),e.jsx(n,{label:"Due Date",value:(b=s.task)!=null&&b.dueDate?u(new Date(s.task.dueDate),"dd MMM yyyy"):"N/A"}),e.jsx(n,{label:"Cancel Reason",value:s.reason}),e.jsx(n,{label:"Status",value:s.status}),e.jsx(n,{label:"Requested At",value:u(new Date(s.requestedAt),"dd MMM yyyy, hh:mm a")})]}):e.jsx(g,{children:"No request found."})}),(s==null?void 0:s.status)==="Pending"&&e.jsxs(y,{children:[e.jsx(l,{onClick:()=>v("Approved"),color:"success",variant:"contained",children:"Approve"}),e.jsx(l,{onClick:()=>v("Rejected"),color:"error",variant:"contained",children:"Reject"})]})]}),e.jsxs(j,{open:B,onClose:()=>c(!1),children:[e.jsxs(p,{children:["Confirm ",r]}),e.jsxs(f,{children:[e.jsxs(T,{children:["Are you sure you want to ",r==null?void 0:r.toLowerCase()," this request?"]}),r==="Rejected"&&e.jsx(X,{label:"Rejection Reason",multiline:!0,rows:3,fullWidth:!0,margin:"dense",value:h,onChange:t=>L(t.target.value),required:!0})]}),e.jsxs(y,{children:[e.jsx(l,{onClick:()=>c(!1),children:"Cancel"}),e.jsx(l,{onClick:U,disabled:O||r==="Rejected"&&!h.trim(),variant:"contained",color:"primary",children:"Confirm"})]})]}),e.jsxs(j,{open:P,onClose:()=>{x(!1),d()},children:[e.jsx(p,{children:"Success"}),e.jsx(f,{children:e.jsx(T,{children:I})}),e.jsx(y,{children:e.jsx(l,{onClick:()=>{x(!1),d()},children:"OK"})})]})]})},n=({label:i,value:m})=>e.jsxs("div",{children:[e.jsx(g,{variant:"subtitle2",color:"text.secondary",gutterBottom:!0,children:i}),e.jsx(g,{variant:"body1",color:"text.primary",sx:{wordBreak:"break-word"},children:m})]});export{de as default};
