import{r as t,j as e,L as E,y as j}from"./index-DlcvTWOH.js";const C="https://silitzer-pharma.onrender.com",T=()=>{const[s,f]=t.useState(null),[m,g]=t.useState(!1),[p,h]=t.useState(""),[x,u]=t.useState(""),[y,l]=t.useState(""),[S,b]=t.useState(!0),[D,w]=t.useState(!1),[o,N]=t.useState(null),v=async()=>{var n;b(!0);try{const a=await fetch(`${C}/employee/profile`,{method:"GET",credentials:"include",headers:{"Content-Type":"application/json"}});if(!a.ok)throw new Error(`HTTP error! status: ${a.status}`);const r=await a.json();f({username:r.username,employeeID:r.EmployeeID,name:r.Name,profilePhoto:r.profilePhotoUrl,email:r.Email,phoneNumber:r.PhoneNumber,address:r.Address,joiningDate:((n=r.JoiningDate)==null?void 0:n.split("T")[0])||""})}catch(a){console.error("Failed to fetch employee profile:",a)}finally{b(!1)}};t.useEffect(()=>{v()},[]);const P=()=>{l(""),m&&(h(""),u("")),g(!m)},d=n=>{const{name:a,value:r}=n.target;f(i=>({...i,[a]:r}))},L=async n=>{if(n.preventDefault(),l(""),p!==x){l("Passwords do not match.");return}let a="";if(o)try{a=await new Promise((r,i)=>{const c=new FileReader;c.readAsDataURL(o),c.onload=()=>r(c.result.split(",")[1]),c.onerror=I=>i(I)})}catch(r){console.error("Failed to read image file:",r),l("Image conversion failed");return}try{w(!0);const r=await fetch(`${C}/employee/profile/update`,{method:"POST",headers:{"Content-Type":"application/json"},credentials:"include",body:JSON.stringify({name:s.name,email:s.email,phoneNumber:s.phoneNumber,address:s.address,password:p||void 0,profileImage:a||void 0,imageName:(o==null?void 0:o.name)||void 0})});if(!r.ok){const i=await r.json();j.error(i.message||"Failed to update profile");return}await v(),j.success("Profile updated successfully"),g(!1),h(""),u(""),N(null)}catch(r){console.error("Error updating profile:",r),j.error("Something went wrong")}finally{w(!1)}};return S?e.jsx(E,{message:"Loading profile..."}):D?e.jsx(E,{message:"Updating profile..."}):s?e.jsxs("div",{className:"employee-profile",children:[e.jsx("div",{className:"photo-container",children:e.jsx("img",{src:o?URL.createObjectURL(o):s.profilePhoto||"/images/default-profile.jpg",alt:`${s.name} profile`,className:"profile-photo"})}),m?e.jsxs("form",{className:"info-container",onSubmit:L,children:[e.jsx("h2",{children:"Edit Profile"}),e.jsxs("label",{children:[e.jsx("strong",{children:"Name:"}),e.jsx("input",{type:"text",name:"name",value:s.name,onChange:d,required:!0})]}),e.jsxs("label",{children:[e.jsx("strong",{children:"Email:"}),e.jsx("input",{type:"email",name:"email",value:s.email,onChange:d,required:!0})]}),e.jsxs("label",{children:[e.jsx("strong",{children:"Phone Number:"}),e.jsx("input",{type:"text",name:"phoneNumber",value:s.phoneNumber,onChange:d})]}),e.jsxs("label",{children:[e.jsx("strong",{children:"Address:"}),e.jsx("input",{type:"text",name:"address",value:s.address,onChange:d})]}),e.jsxs("label",{children:[e.jsx("strong",{children:"Profile Image:"}),e.jsx("input",{type:"file",accept:"image/*",onChange:n=>N(n.target.files[0])})]}),e.jsxs("label",{children:[e.jsx("strong",{children:"Joining Date:"}),e.jsx("input",{type:"date",name:"joiningDate",value:s.joiningDate,disabled:!0})]}),e.jsxs("label",{children:[e.jsx("strong",{children:"Password:"}),e.jsx("input",{type:"password",name:"password",value:p,onChange:n=>h(n.target.value),placeholder:"Enter new password"})]}),e.jsxs("label",{children:[e.jsx("strong",{children:"Confirm Password:"}),e.jsx("input",{type:"password",name:"confirmPassword",value:x,onChange:n=>u(n.target.value),placeholder:"Confirm new password"})]}),y&&e.jsx("p",{className:"error-msg",children:y}),e.jsxs("div",{className:"buttons-row",children:[e.jsx("button",{type:"submit",className:"save-btn",children:"Save"}),e.jsx("button",{type:"button",className:"cancel-btn",onClick:P,children:"Cancel"})]})]}):e.jsxs("div",{className:"info-container",children:[e.jsx("h2",{children:s.name}),e.jsxs("p",{children:[e.jsx("strong",{children:"Username:"})," ",s.username]}),e.jsxs("p",{children:[e.jsx("strong",{children:"Employee ID:"})," ",s.employeeID]}),e.jsxs("p",{children:[e.jsx("strong",{children:"Email:"})," ",s.email]}),e.jsxs("p",{children:[e.jsx("strong",{children:"Phone Number:"})," ",s.phoneNumber]}),e.jsxs("p",{children:[e.jsx("strong",{children:"Address:"})," ",s.address]}),e.jsxs("p",{children:[e.jsx("strong",{children:"Joining Date:"})," ",s.joiningDate]}),e.jsx("button",{className:"edit-btn",onClick:P,children:"Edit Profile"})]})]}):e.jsx("div",{className:"employee-profile",children:"Failed to load profile."})};export{T as default};
