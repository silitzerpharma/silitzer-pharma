import{f as x,j as s,o as b,h as E,i as z,r as n,l as L,p as $,q as F,t as M,C as R,v as S,T as c,D as U,B as k}from"./index-DlcvTWOH.js";import{D as H}from"./Delete-gQpfo2Ul.js";import{D as O,a as D,b as I,c as Y}from"./DialogTitle-DGL2koDV.js";import{S as V}from"./Snackbar-z76ToobN.js";import{A as W}from"./Alert-D_RgXu2Q.js";import"./IconButton-eRt6TsSc.js";const G=x(s.jsx("path",{d:"M22 12c0-5.52-4.48-10-10-10S2 6.48 2 12s4.48 10 10 10 10-4.48 10-10m-10 1H8v-2h4V8l4 4-4 4z"})),J=x(s.jsx("path",{d:"M22 3H7c-.69 0-1.23.35-1.59.88L0 12l5.41 8.11c.36.53.9.89 1.59.89h15c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2m-3 12.59L17.59 17 14 13.41 10.41 17 9 15.59 12.59 12 9 8.41 10.41 7 14 10.59 17.59 7 19 8.41 15.41 12z"})),K=x(s.jsx("path",{d:"M16.59 7.58 10 14.17l-3.59-3.58L5 12l5 5 8-8zM12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2m0 18c-4.42 0-8-3.58-8-8s3.58-8 8-8 8 3.58 8 8-3.58 8-8 8"})),X="https://silitzer-pharma.onrender.com",ns=()=>{const r=b(e=>e.cart),i=E(),w=b(e=>e.user.user.id),p=z(),[l,j]=n.useState(null),[d,g]=n.useState(""),[P,u]=n.useState(!1),[_,o]=n.useState(!1),[y,v]=n.useState(!1),[T,f]=n.useState(!1),[q,C]=n.useState({});n.useEffect(()=>{const e={};r.forEach(a=>{e[a._id]=String(a.quantity)}),C(e)},[r]);const h=r.reduce((e,a)=>e+a.quantity,0),B=async()=>{o(!1),v(!0);const e=r.map(({_id:t,productName:m,quantity:A})=>({productId:t,productName:m,quantity:A})),a={distributor:w,productList:e,instructions:d};try{const t=await fetch(`${X}/distributor/placeorder`,{method:"POST",headers:{"Content-Type":"application/json"},credentials:"include",body:JSON.stringify({payload:a})});if(!t.ok)throw new Error(`Server error: ${t.statusText}`);await t.json(),i(S()),g(""),j(null),u(!0),f(!0)}catch(t){j({type:"error",text:`Failed to place order: ${t.message}`})}finally{v(!1)}},N=e=>{p(`/distributor/product/${e}`)},Q=(e,a)=>{if(/^\d*$/.test(a)){C(m=>({...m,[e]:a}));const t=parseInt(a,10);!isNaN(t)&&t>0&&i({type:"cart/setQuantity",payload:{productId:e,quantity:t}})}};return s.jsxs("div",{className:"cart-container",children:[r.length===0?s.jsxs("div",{className:"empty-cart-div",children:[s.jsx("p",{children:"Your cart is empty"}),s.jsx("button",{onClick:()=>p("/"),className:"go-shop-btn",children:"Go to Shop"})]}):s.jsxs(s.Fragment,{children:[s.jsxs("div",{className:"cart-container-left",children:[s.jsx("div",{className:"cart-header",children:s.jsxs("span",{children:[h," item",h!==1?"s":""," in your Cart"]})}),l&&s.jsx("div",{className:`message ${l.type}`,style:{margin:"10px 0"},children:l.text}),r.map((e,a)=>s.jsxs(L.div,{className:"cart-product",initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:a*.1},children:[s.jsx("div",{className:"left",onClick:()=>N(e._id),children:s.jsx("img",{src:e.imageUrl||"/images/default-product.jpg",alt:e.productName||"Product",onError:t=>{t.target.onerror=null,t.target.src="/images/default-product.png"}})}),s.jsxs("div",{className:"right",children:[s.jsx("div",{className:"cart-product-name",onClick:()=>N(e._id),children:e.productName}),e.unitsPerBox>0&&s.jsxs("p",{className:"units-info",children:["Units per Box: ",e.unitsPerBox]}),s.jsxs("div",{className:"inde",children:[s.jsxs("div",{className:"qty-input",children:[s.jsx("button",{className:"btn-decrease",onClick:()=>{e.quantity>1&&i($(e._id))},children:"-"}),s.jsx("input",{type:"number",min:"1",value:q[e._id]||"",onChange:t=>Q(e._id,t.target.value),placeholder:"Qty 1"}),s.jsx("button",{className:"btn-increase",onClick:()=>i(F(e._id)),children:"+"})]}),s.jsx(H,{className:"remove-icon",style:{cursor:"pointer"},onClick:()=>i(M(e._id))})]})]})]},e._id))]}),s.jsxs("div",{className:"cart-container-right",children:[s.jsx("textarea",{className:"order-instructions",placeholder:"Add order instructions...",rows:4,value:d,onChange:e=>g(e.target.value)}),s.jsxs("div",{className:"order-summary",children:[s.jsx("h3",{children:"Order Summary"}),s.jsxs("p",{children:[s.jsx("strong",{children:"Total Products:"})," ",r.length]}),s.jsxs("p",{children:[s.jsx("strong",{children:"Total Quantity:"})," ",h]})]}),s.jsx("div",{className:"place-order-btn",children:s.jsx("button",{onClick:()=>o(!0),disabled:y,children:y?s.jsx(R,{size:22,style:{color:"white"}}):s.jsxs(s.Fragment,{children:["Place Order ",s.jsx(G,{})]})})}),s.jsxs("button",{className:"clear-btn",onClick:()=>i(S()),children:[s.jsx(J,{})," Clear Cart"]})]})]}),s.jsxs(O,{open:_,onClose:()=>o(!1),maxWidth:"sm",fullWidth:!0,children:[s.jsx(D,{children:"Order Preview"}),s.jsxs(I,{dividers:!0,children:[r.map(e=>s.jsxs("div",{style:{display:"flex",gap:12,marginBottom:16},children:[s.jsx("img",{src:e.imageUrl||"/images/default-product.jpg",alt:e.productName,style:{width:60,height:60,objectFit:"cover",borderRadius:6}}),s.jsxs("div",{children:[s.jsx(c,{variant:"subtitle1",children:e.productName}),s.jsxs(c,{variant:"body2",children:["Quantity: ",e.quantity]})]})]},e._id)),s.jsx(U,{sx:{my:2}}),s.jsxs(c,{variant:"body2",color:"text.secondary",children:["Instructions: ",d||"None"]})]}),s.jsxs(Y,{children:[s.jsx(k,{onClick:()=>o(!1),children:"Cancel"}),s.jsx(k,{variant:"contained",onClick:B,children:"Confirm & Place Order"})]})]}),s.jsxs(O,{open:P,onClose:()=>u(!1),children:[s.jsx(D,{children:s.jsxs(c,{variant:"h6",component:"div",style:{display:"flex",alignItems:"center",gap:"10px"},children:[s.jsx(K,{color:"success"}),"Your order was placed successfully!"]})}),s.jsxs(I,{children:[s.jsx(c,{variant:"body1",children:"Thank you for your order. You can continue shopping or check your orders."}),s.jsx("div",{style:{marginTop:"16px",textAlign:"right"},children:s.jsx("button",{onClick:()=>u(!1),className:"go-shop-btn",children:"OK"})})]})]}),s.jsx(V,{open:T,autoHideDuration:4e3,onClose:()=>f(!1),anchorOrigin:{vertical:"bottom",horizontal:"center"},children:s.jsx(W,{severity:"success",sx:{width:"100%"},children:"Order placed successfully!"})})]})};export{ns as default};
