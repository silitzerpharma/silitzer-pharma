import{r as n,j as e,L as O,B as P,y as p}from"./index-DlcvTWOH.js";import{D as B,a as F,b as U,c as V}from"./DialogTitle-DGL2koDV.js";import{T as y}from"./TextField-Doo77Nta.js";import{I as C,V as v,a as S}from"./VisibilityOff-BFM2Af0E.js";import{I as N}from"./IconButton-eRt6TsSc.js";import"./Select-BpVlYiRl.js";import"./useControlled-CHhDBfC_.js";import"./useFormControl-CXPDb4oN.js";import"./InputLabel-Bd8_Eb26.js";const h="https://silitzer-pharma.onrender.com",M=()=>{const[r,u]=n.useState({}),[a,E]=n.useState(!1),[T,o]=n.useState(!1),[d,m]=n.useState(""),[f,x]=n.useState(""),[j,i]=n.useState(""),[D,g]=n.useState(!1),[w,I]=n.useState(!1),[b,k]=n.useState(!1);n.useEffect(()=>{(async()=>{g(!0);try{const c=await(await fetch(`${h}/distributor/profile`,{method:"GET",credentials:"include",headers:{"Content-Type":"application/json"}})).json();u(c)}catch(t){console.error("Error fetching profile:",t)}finally{g(!1)}})()},[]);const l=s=>{const{name:t,value:c}=s.target;u(L=>({...L,[t]:c}))},A=async()=>{if(a)try{await fetch(`${h}/distributor/saveprofile`,{method:"POST",credentials:"include",headers:{"Content-Type":"application/json"},body:JSON.stringify(r)}),p.success("Profile updated successfully")}catch(s){console.error("Error saving profile:",s),p.error("Failed to save profile")}E(s=>!s)},_=async()=>{if(d!==f){i("Passwords do not match");return}try{const s=await fetch(`${h}/distributor/savepassword`,{method:"POST",credentials:"include",headers:{"Content-Type":"application/json"},body:JSON.stringify({password:d})}),t=await s.json();s.ok?(o(!1),m(""),x(""),i(""),p.success("Password changed successfully")):i(t.message||"Failed to update password")}catch(s){console.error("Error updating password:",s),i("Server error")}};return D?e.jsx(O,{message:"Loading Profile..."}):e.jsxs("div",{className:"profile-container",children:[e.jsx("h2",{children:"User Profile"}),e.jsxs("div",{className:"profile-form",children:[e.jsxs("label",{children:["Username:",e.jsx("span",{children:r.username})]}),e.jsxs("label",{children:["Name:",a?e.jsx("input",{type:"text",name:"name",value:r.name,onChange:l}):e.jsx("span",{children:r.name})]}),e.jsxs("label",{children:["Phone Number:",a?e.jsx("input",{type:"text",name:"phone_number",value:r.phone_number,onChange:l}):e.jsx("span",{children:r.phone_number})]}),e.jsxs("label",{children:["Email Address:",a?e.jsx("input",{type:"email",name:"email",value:r.email,onChange:l}):e.jsx("span",{children:r.email})]}),e.jsxs("label",{children:["GSTIN Number:",e.jsx("span",{children:r.gst_number||"Not provided"})]}),e.jsxs("label",{children:["Drug License Number:",e.jsx("span",{children:r.drug_license_number||"Not provided"})]}),e.jsxs("label",{children:["Address:",a?e.jsx("input",{type:"text",name:"address",value:r.address,onChange:l}):e.jsx("span",{children:r.address})]}),e.jsx("button",{className:"edit-btn",onClick:A,children:a?"Save":"Edit"}),!a&&e.jsx("button",{className:"edit-btn",onClick:()=>o(!0),children:"Change Password"})]}),e.jsxs(B,{open:T,onClose:()=>o(!1),children:[e.jsx(F,{children:"Change Password"}),e.jsxs(U,{children:[e.jsx(y,{label:"New Password",type:w?"text":"password",fullWidth:!0,margin:"dense",value:d,onChange:s=>m(s.target.value),InputProps:{endAdornment:e.jsx(C,{position:"end",children:e.jsx(N,{onClick:()=>I(s=>!s),edge:"end",children:w?e.jsx(v,{}):e.jsx(S,{})})})}}),e.jsx(y,{label:"Confirm Password",type:b?"text":"password",fullWidth:!0,margin:"dense",value:f,onChange:s=>x(s.target.value),error:!!j,helperText:j,InputProps:{endAdornment:e.jsx(C,{position:"end",children:e.jsx(N,{onClick:()=>k(s=>!s),edge:"end",children:b?e.jsx(v,{}):e.jsx(S,{})})})}})]}),e.jsxs(V,{children:[e.jsx(P,{onClick:()=>o(!1),children:"Cancel"}),e.jsx(P,{onClick:_,variant:"contained",color:"primary",children:"Save"})]})]})]})};export{M as default};
