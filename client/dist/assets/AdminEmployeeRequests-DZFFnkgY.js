import{r as t,w as te,j as e,B as a}from"./index-DlcvTWOH.js";import{D as x,a as m,b as p,c as g}from"./DialogTitle-DGL2koDV.js";import{D as W}from"./DialogContentText-BFDKx7jj.js";import{T as ne}from"./TextField-Doo77Nta.js";import{f as c}from"./format-CfEi8zQK.js";import"./Select-BpVlYiRl.js";import"./useControlled-CHhDBfC_.js";import"./useFormControl-CXPDb4oN.js";import"./InputLabel-Bd8_Eb26.js";const je=({employeeId:b,refreshEmployeeData:$=()=>{}})=>{const[C,B]=t.useState([]),[S,z]=t.useState([]),[k,w]=t.useState(!1),[f,d]=t.useState(null),[G,E]=t.useState(!1),[n,T]=t.useState(null),[J,L]=t.useState(!1),[i,N]=t.useState(null),[K,A]=t.useState(!1),[l,P]=t.useState(null),[O,F]=t.useState(null),[u,I]=t.useState(""),[U,_]=t.useState(!1),[H,v]=t.useState(!1),[Q,V]=t.useState(""),{employeeId:X}=te(),h=X||b,y="https://silitzer-pharma.onrender.com",M=async()=>{if(h){w(!0),d(null);try{console.log(h);const s=await fetch(`${y}/admin/employee/requests?employeeId=${h}`,{method:"GET",credentials:"include"});if(!s.ok){const o=await s.json();throw new Error(o.message||"Failed to fetch employee requests")}const r=await s.json();B(r.cancelRequests||[]),z(r.leaveRequests||[])}catch(s){d(s.message||"Error fetching data")}finally{w(!1)}}};t.useEffect(()=>{M()},[h]);const Y=s=>{T(s),E(!0)},Z=s=>{N(s),L(!0)},R=()=>{E(!1),T(null)},D=()=>{L(!1),N(null)},j=(s,r)=>{P(s),F(r),A(!0)},q=()=>{A(!1),P(null),F(null),I("")},ee=async()=>{if(!l||!n&&!i)return;_(!0),d(null);let s="",r={};O==="cancel"?(s=`${y}/admin/employee/taskcancelrequest/update`,r={requestId:n._id,action:l},l==="Rejected"&&(r.rejectionReason=u)):O==="leave"&&(s=`${y}/admin/employee/leaverequest/update`,r={_id:i._id,action:l},l==="Rejected"&&(r.rejectionReason=u));try{const o=await fetch(s,{method:"POST",headers:{"Content-Type":"application/json"},credentials:"include",body:JSON.stringify(r)});if(!o.ok)throw new Error("Failed to update request status");const se=await o.json();V(se.message||"Request updated successfully"),v(!0),$(),q(),R(),D(),M()}catch(o){d(o.message||"Error updating request")}finally{_(!1)}};return e.jsxs("div",{className:"EmployeeRequest",children:[e.jsx("div",{className:"EmployeeRequest-title",children:"Employee Requests"}),k&&e.jsx("div",{children:"Loading requests..."}),f&&e.jsxs("div",{className:"error",children:["Error: ",f]}),!k&&!f&&e.jsxs("div",{className:"EmployeeRequest-row",children:[e.jsxs("div",{className:"request-col-left",children:[e.jsx("div",{className:"request-title",children:"Task Cancel Requests"}),e.jsx("ul",{className:"emp-request-list",children:C.length===0?e.jsx("li",{children:"No cancel requests found"}):C.map(s=>{var r;return e.jsxs("li",{className:"request-card",onClick:()=>Y(s),children:[e.jsxs("div",{children:[e.jsx("strong",{children:"Task:"})," ",((r=s.task)==null?void 0:r.title)||s.taskId]}),e.jsxs("div",{children:[e.jsx("strong",{children:"Reason:"})," ",s.reason]}),e.jsxs("div",{children:[e.jsxs("span",{children:[e.jsx("strong",{children:"Status:"})," ",s.status]}),e.jsxs("span",{style:{marginLeft:10},children:[e.jsx("strong",{children:"Requested At:"})," ",c(new Date(s.requestedAt),"d/M/yyyy h:mm a")]})]})]},s._id)})})]}),e.jsxs("div",{className:"request-col-right",children:[e.jsx("div",{className:"request-title",children:"Leave Requests"}),e.jsx("ul",{className:"emp-request-list",children:S.length===0?e.jsx("li",{children:"No leave requests found"}):S.map(s=>e.jsxs("li",{className:"request-card",onClick:()=>Z(s),children:[e.jsxs("div",{children:[e.jsx("strong",{children:"Leave Type:"})," ",s.leaveType]}),e.jsxs("div",{children:[e.jsx("strong",{children:"Status:"})," ",s.status]}),e.jsxs("div",{children:[e.jsx("strong",{children:"Start:"})," ",c(new Date(s.startDate),"d/M/yyyy")," -",e.jsx("strong",{children:" End:"})," ",c(new Date(s.endDate),"d/M/yyyy")]}),e.jsxs("div",{children:[e.jsx("strong",{children:"Reason:"})," ",s.reason]})]},s._id))})]})]}),e.jsxs(x,{open:G,onClose:R,maxWidth:"sm",fullWidth:!0,children:[e.jsx(m,{children:"Cancel Request Details"}),e.jsx(p,{dividers:!0,children:n&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{children:[e.jsx("strong",{children:"Request ID:"})," ",n.requestId]}),e.jsxs("div",{children:[e.jsx("strong",{children:"Reason:"})," ",n.reason]}),e.jsxs("div",{children:[e.jsx("strong",{children:"Status:"})," ",n.status]}),e.jsxs("div",{children:[e.jsx("strong",{children:"Requested At:"})," ",c(new Date(n.requestedAt),"PPpp")]}),n.task&&e.jsxs(e.Fragment,{children:[e.jsx("h4",{children:"Task Details"}),e.jsxs("div",{children:[e.jsx("strong",{children:"Title:"})," ",n.task.title]}),e.jsxs("div",{children:[e.jsx("strong",{children:"Description:"})," ",n.task.description]})]})]})}),e.jsxs(g,{children:[e.jsx(a,{onClick:R,children:"Close"}),(n==null?void 0:n.status)==="Pending"&&e.jsxs(e.Fragment,{children:[e.jsx(a,{onClick:()=>j("Approved","cancel"),color:"success",variant:"contained",children:"Approve"}),e.jsx(a,{onClick:()=>j("Rejected","cancel"),color:"error",variant:"contained",children:"Reject"})]})]})]}),e.jsxs(x,{open:J,onClose:D,maxWidth:"sm",fullWidth:!0,children:[e.jsx(m,{children:"Leave Request Details"}),e.jsx(p,{dividers:!0,children:i&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{children:[e.jsx("strong",{children:"Leave Type:"})," ",i.leaveType]}),e.jsxs("div",{children:[e.jsx("strong",{children:"Status:"})," ",i.status]}),e.jsxs("div",{children:[e.jsx("strong",{children:"Reason:"})," ",i.reason]}),e.jsxs("div",{children:[e.jsx("strong",{children:"Start Date:"})," ",c(new Date(i.startDate),"PP")]}),e.jsxs("div",{children:[e.jsx("strong",{children:"End Date:"})," ",c(new Date(i.endDate),"PP")]})]})}),e.jsxs(g,{children:[e.jsx(a,{onClick:D,children:"Close"}),(i==null?void 0:i.status)==="Pending"&&e.jsxs(e.Fragment,{children:[e.jsx(a,{onClick:()=>j("Approved","leave"),color:"success",variant:"contained",children:"Approve"}),e.jsx(a,{onClick:()=>j("Rejected","leave"),color:"error",variant:"contained",children:"Reject"})]})]})]}),e.jsxs(x,{open:K,onClose:q,children:[e.jsxs(m,{children:["Confirm ",l,"?"]}),e.jsxs(p,{children:[e.jsxs(W,{children:["Are you sure you want to ",l==null?void 0:l.toLowerCase()," this request?"]}),l==="Rejected"&&e.jsx(ne,{label:"Rejection Reason",multiline:!0,rows:3,fullWidth:!0,margin:"dense",value:u,onChange:s=>I(s.target.value),required:!0})]}),e.jsxs(g,{children:[e.jsx(a,{onClick:q,children:"Cancel"}),e.jsx(a,{onClick:ee,disabled:U||l==="Rejected"&&!u.trim(),variant:"contained",color:"primary",children:"Confirm"})]})]}),e.jsxs(x,{open:H,onClose:()=>v(!1),children:[e.jsx(m,{children:"Success"}),e.jsx(p,{children:e.jsx(W,{children:Q})}),e.jsx(g,{children:e.jsx(a,{onClick:()=>v(!1),autoFocus:!0,children:"OK"})})]})]})};export{je as default};
