import{r,j as e,L as A,a5 as h}from"./index-DlcvTWOH.js";import{s as W,e as C,a as O,b as F,i as _,c as q,d as G}from"./isSameMonth-Bh9_FtD7.js";import{s as P,f as a}from"./format-CfEi8zQK.js";const M="https://silitzer-pharma.onrender.com",H=()=>{var L,w;const[g,m]=r.useState(new Date),[D,k]=r.useState({}),[y,S]=r.useState(new Set),[c,u]=r.useState(null),[$,j]=r.useState(!1),i=W(g),N=C(i),x=P(i),p=O(N),T=r.useMemo(()=>{const t=[];for(let s=x;s<=p;s=F(s,1))t.push(s);return t},[x,p]);r.useEffect(()=>{const t=a(i,"yyyy-MM");if(y.has(t))return;(async()=>{j(!0);try{const n=await(await fetch(`${M}/employee/work/month?month=${t}`,{method:"GET",credentials:"include"})).json();if(Array.isArray(n)){const d={};n.forEach(l=>{const[b,E]=Object.entries(l)[0];d[b]=E}),k(l=>({...l,...d})),S(l=>new Set(l).add(t))}}catch(o){console.error("Failed to fetch work dates:",o)}finally{j(!1)}})()},[i,y]);const v=async t=>{m(t);const s=a(t,"yyyy-MM-dd");try{const o=await fetch(`${M}/employee/work/day?day=${s}`,{method:"GET",credentials:"include"});if(!o.ok)throw new Error(`HTTP error! status: ${o.status}`);const n=await o.json();u(n)}catch(o){console.error("Failed to fetch day work data:",o),u(null)}},f=t=>{m(s=>G(s,t))};return $?e.jsx(A,{message:"Loading employee work..."}):e.jsxs("div",{className:"employee-work",children:[e.jsxs("div",{className:"calendar-header",children:[e.jsx("button",{onClick:()=>f(-1),children:"←"}),e.jsx("div",{className:"month-label",children:a(i,"MMMM yyyy")}),e.jsx("button",{onClick:()=>f(1),children:"→"})]}),e.jsx("div",{className:"calendar-weekdays",children:["Sun","Mon","Tue","Wed","Thu","Fri","Sat"].map(t=>e.jsx("div",{className:"weekday",children:t},t))}),e.jsx("div",{className:"calendar-grid",children:T.map(t=>{const s=a(t,"yyyy-MM-dd"),o=_(t,i),n=q(t,g),d=D[s]===!0;return e.jsxs("div",{onClick:()=>v(t),className:`calendar-day ${o?"":"not-current"} ${n?"selected":""}`,children:[a(t,"d"),d&&e.jsx("span",{className:"dot green"})]},s)})}),c&&e.jsxs("div",{className:"day-details",children:[e.jsxs("div",{className:"card",children:[e.jsx("h3",{children:"Login Sessions"}),(L=c.loginSessions)!=null&&L.length?c.loginSessions.map((t,s)=>{var o,n;return e.jsxs("div",{className:"session-block",children:[e.jsxs("p",{children:[e.jsx("strong",{children:"Login:"})," ",t.loginTime?a(new Date(t.loginTime),"dd/MM/yyyy hh:mm a"):"N/A"]}),((o=t.loginLocation)==null?void 0:o.latitude)&&e.jsxs("p",{children:[e.jsx("strong",{children:"Login Location:"})," ",`${t.loginLocation.latitude}, ${t.loginLocation.longitude}`,e.jsx("a",{href:`https://www.google.com/maps?q=${t.loginLocation.latitude},${t.loginLocation.longitude}`,target:"_blank",rel:"noopener noreferrer",children:e.jsx(h,{style:{color:"red",marginLeft:5}})})]}),e.jsxs("p",{children:[e.jsx("strong",{children:"Logout:"})," ",t.logoutTime?a(new Date(t.logoutTime),"dd/MM/yyyy hh:mm a"):"N/A"]}),((n=t.logoutLocation)==null?void 0:n.latitude)&&e.jsxs("p",{children:[e.jsx("strong",{children:"Logout Location:"})," ",`${t.logoutLocation.latitude}, ${t.logoutLocation.longitude}`,e.jsx("a",{href:`https://www.google.com/maps?q=${t.logoutLocation.latitude},${t.logoutLocation.longitude}`,target:"_blank",rel:"noopener noreferrer",children:e.jsx(h,{style:{color:"red",marginLeft:5}})})]})]},s)}):e.jsx("p",{children:"No login sessions."})]}),e.jsxs("div",{className:"card",children:[e.jsx("h3",{children:"Tasks"}),(w=c.tasks)!=null&&w.length?c.tasks.map((t,s)=>{var o;return e.jsxs("div",{className:"task-block",children:[e.jsxs("p",{children:[e.jsx("strong",{children:"Task ID:"})," ",t.taskId]}),e.jsxs("p",{children:[e.jsx("strong",{children:"Title:"})," ",t.title]}),e.jsxs("p",{children:[e.jsx("strong",{children:"Description:"})," ",t.description]}),e.jsxs("p",{children:[e.jsx("strong",{children:"Status:"})," ",t.status]}),e.jsxs("p",{children:[e.jsx("strong",{children:"Address:"})," ",t.address]}),e.jsxs("p",{children:[e.jsx("strong",{children:"Notes:"})," ",t.notes]}),e.jsxs("p",{children:[e.jsx("strong",{children:"Assign Date:"})," ",a(new Date(t.assignDate),"dd/MM/yyyy")]}),((o=t.completionLocation)==null?void 0:o.latitude)&&e.jsxs("p",{children:[e.jsx("strong",{children:"Completion Location:"})," ",`${t.completionLocation.latitude}, ${t.completionLocation.longitude}`,e.jsx("a",{href:`https://www.google.com/maps?q=${t.completionLocation.latitude},${t.completionLocation.longitude}`,target:"_blank",rel:"noopener noreferrer",children:e.jsx(h,{style:{color:"red",marginLeft:5}})})]})]},s)}):e.jsx("p",{children:"No tasks."})]})]})]})};export{H as default};
