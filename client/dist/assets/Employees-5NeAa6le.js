import{a as ce,g as de,r as n,u as pe,J as O,s as B,c as ue,j as e,K as L,b as me,m as A,d as W,M as he,V as ge,W as ye,X as xe,B as P,T as N,E as M,L as V,P as fe,y as U}from"./index-DlcvTWOH.js";/* empty css              */import{L as z,V as je,T as we}from"./ViewEmployee-DQQiU_fN.js";import{a as q,b as H,c as be,D as X}from"./DialogTitle-DGL2koDV.js";import{T as E}from"./TextField-Doo77Nta.js";import{I as _}from"./IconButton-eRt6TsSc.js";import{T as Se}from"./TableContainer-CQmYnS7h.js";import{T as ke,a as ve,b as J,c as j,d as De}from"./TableRow-DuThesGT.js";import{S as Te}from"./SwitchBase--2o_48n6.js";import{P as Ce}from"./Pagination-Dncr6agV.js";import"./useControlled-CHhDBfC_.js";import"./index-0sQ3Nx8k.js";import"./getThemeProps-DR8AxGiy.js";import"./Stack-B0Za308U.js";import"./format-CfEi8zQK.js";import"./AdminEmployeeRequests-DZFFnkgY.js";import"./DialogContentText-BFDKx7jj.js";import"./Select-BpVlYiRl.js";import"./useFormControl-CXPDb4oN.js";import"./InputLabel-Bd8_Eb26.js";import"./LastPage-DpFt_x2b.js";function Ee(t){return de("MuiSwitch",t)}const y=ce("MuiSwitch",["root","edgeStart","edgeEnd","switchBase","colorPrimary","colorSecondary","sizeSmall","sizeMedium","checked","disabled","input","thumb","track"]),Le=t=>{const{classes:a,edge:s,size:g,color:r,checked:m,disabled:c}=t,h={root:["root",s&&`edge${L(s)}`,`size${L(g)}`],switchBase:["switchBase",`color${L(r)}`,m&&"checked",c&&"disabled"],thumb:["thumb"],track:["track"],input:["input"]},u=me(h,Ee,a);return{...a,...u}},$e=B("span",{name:"MuiSwitch",slot:"Root",overridesResolver:(t,a)=>{const{ownerState:s}=t;return[a.root,s.edge&&a[`edge${L(s.edge)}`],a[`size${L(s.size)}`]]}})({display:"inline-flex",width:34+12*2,height:14+12*2,overflow:"hidden",padding:12,boxSizing:"border-box",position:"relative",flexShrink:0,zIndex:0,verticalAlign:"middle","@media print":{colorAdjust:"exact"},variants:[{props:{edge:"start"},style:{marginLeft:-8}},{props:{edge:"end"},style:{marginRight:-8}},{props:{size:"small"},style:{width:40,height:24,padding:7,[`& .${y.thumb}`]:{width:16,height:16},[`& .${y.switchBase}`]:{padding:4,[`&.${y.checked}`]:{transform:"translateX(16px)"}}}}]}),Ne=B(Te,{name:"MuiSwitch",slot:"SwitchBase",overridesResolver:(t,a)=>{const{ownerState:s}=t;return[a.switchBase,{[`& .${y.input}`]:a.input},s.color!=="default"&&a[`color${L(s.color)}`]]}})(A(({theme:t})=>({position:"absolute",top:0,left:0,zIndex:1,color:t.vars?t.vars.palette.Switch.defaultColor:`${t.palette.mode==="light"?t.palette.common.white:t.palette.grey[300]}`,transition:t.transitions.create(["left","transform"],{duration:t.transitions.duration.shortest}),[`&.${y.checked}`]:{transform:"translateX(20px)"},[`&.${y.disabled}`]:{color:t.vars?t.vars.palette.Switch.defaultDisabledColor:`${t.palette.mode==="light"?t.palette.grey[100]:t.palette.grey[600]}`},[`&.${y.checked} + .${y.track}`]:{opacity:.5},[`&.${y.disabled} + .${y.track}`]:{opacity:t.vars?t.vars.opacity.switchTrackDisabled:`${t.palette.mode==="light"?.12:.2}`},[`& .${y.input}`]:{left:"-100%",width:"300%"}})),A(({theme:t})=>({"&:hover":{backgroundColor:t.vars?`rgba(${t.vars.palette.action.activeChannel} / ${t.vars.palette.action.hoverOpacity})`:W(t.palette.action.active,t.palette.action.hoverOpacity),"@media (hover: none)":{backgroundColor:"transparent"}},variants:[...Object.entries(t.palette).filter(he(["light"])).map(([a])=>({props:{color:a},style:{[`&.${y.checked}`]:{color:(t.vars||t).palette[a].main,"&:hover":{backgroundColor:t.vars?`rgba(${t.vars.palette[a].mainChannel} / ${t.vars.palette.action.hoverOpacity})`:W(t.palette[a].main,t.palette.action.hoverOpacity),"@media (hover: none)":{backgroundColor:"transparent"}},[`&.${y.disabled}`]:{color:t.vars?t.vars.palette.Switch[`${a}DisabledColor`]:`${t.palette.mode==="light"?ge(t.palette[a].main,.62):ye(t.palette[a].main,.55)}`}},[`&.${y.checked} + .${y.track}`]:{backgroundColor:(t.vars||t).palette[a].main}}}))]}))),Ae=B("span",{name:"MuiSwitch",slot:"Track"})(A(({theme:t})=>({height:"100%",width:"100%",borderRadius:14/2,zIndex:-1,transition:t.transitions.create(["opacity","background-color"],{duration:t.transitions.duration.shortest}),backgroundColor:t.vars?t.vars.palette.common.onBackground:`${t.palette.mode==="light"?t.palette.common.black:t.palette.common.white}`,opacity:t.vars?t.vars.opacity.switchTrack:`${t.palette.mode==="light"?.38:.3}`}))),Pe=B("span",{name:"MuiSwitch",slot:"Thumb"})(A(({theme:t})=>({boxShadow:(t.vars||t).shadows[1],backgroundColor:"currentColor",width:20,height:20,borderRadius:"50%"}))),Be=n.forwardRef(function(a,s){const g=pe({props:a,name:"MuiSwitch"}),{className:r,color:m="primary",edge:c=!1,size:h="medium",sx:u,slots:i={},slotProps:d={},...S}=g,p={...g,color:m,edge:c,size:h},w=Le(p),b={slots:i,slotProps:d},[C,$]=O("root",{className:ue(w.root,r),elementType:$e,externalForwardedProps:b,ownerState:p,additionalProps:{sx:u}}),[l,x]=O("thumb",{className:w.thumb,elementType:Pe,externalForwardedProps:b,ownerState:p}),k=e.jsx(l,{...x}),[f,v]=O("track",{className:w.track,elementType:Ae,externalForwardedProps:b,ownerState:p});return e.jsxs(C,{...$,children:[e.jsx(Ne,{type:"checkbox",icon:k,checkedIcon:k,ref:s,ownerState:p,...S,classes:{...w,root:w.switchBase},slots:{...i.switchBase&&{root:i.switchBase},...i.input&&{input:i.input}},slotProps:{...d.switchBase&&{root:typeof d.switchBase=="function"?d.switchBase(p):d.switchBase},...d.input&&{input:typeof d.input=="function"?d.input(p):d.input}}}),e.jsx(f,{...v})]})}),Oe="https://silitzer-pharma.onrender.com",Ue=["Low","Medium","High"],ze=({employeeObjectId:t,onClose:a})=>{const[s,g]=n.useState("Assigned"),[r,m]=n.useState({title:"",description:"",priority:"",startDate:"",dueDate:"",address:""}),[c,h]=n.useState(""),[u,i]=n.useState(""),[d,S]=n.useState(""),p=()=>{const l=new Date;return l.setHours(0,0,0,0),l.toLocaleDateString("en-CA")},w=()=>{const l=new Date;return l.setDate(l.getDate()+1),l.setHours(0,0,0,0),l.toLocaleDateString("en-CA")};n.useEffect(()=>{m(s==="Assigned"?l=>({...l,startDate:p()}):l=>({...l,startDate:""})),h(""),i(""),S("")},[s]);const b=l=>{const{name:x,value:k}=l.target;m(f=>({...f,[x]:k})),x==="title"&&h(""),x==="startDate"&&i(""),x==="dueDate"&&S("")},C=l=>{g(l)},$=async()=>{const{title:l,startDate:x,dueDate:k}=r;if(!l.trim()){h(`${s} task requires a title`);return}if(s==="Scheduled"){if(!x){i("Start date is required for scheduled tasks");return}const f=new Date(x),v=new Date;if(v.setHours(0,0,0,0),f<=v){i("Start date must be after today for scheduled tasks");return}}if(k){const f=new Date(k),v=new Date(r.startDate||p());if(f<v){S("Due date cannot be earlier than start date");return}}try{if(!(await fetch(`${Oe}/admin/employee/assigntask`,{method:"POST",headers:{"Content-Type":"application/json"},credentials:"include",body:JSON.stringify({...r,taskType:s,employeeObjectId:t})})).ok)throw new Error("Failed to assign task");alert("Task assigned successfully"),a()}catch(f){console.error("Error assigning task:",f),alert("Error assigning task")}};return e.jsxs(e.Fragment,{children:[e.jsxs(q,{children:[e.jsx("span",{style:{cursor:"pointer",fontWeight:s==="Assigned"?"bold":"normal",marginRight:10},onClick:()=>C("Assigned"),children:"Assign Task"}),"/",e.jsx("span",{style:{cursor:"pointer",fontWeight:s==="Scheduled"?"bold":"normal",marginLeft:10},onClick:()=>C("Scheduled"),children:"Scheduled Task"})]}),e.jsxs(H,{dividers:!0,children:[e.jsx(E,{fullWidth:!0,label:"Title",name:"title",value:r.title,onChange:b,margin:"dense",error:!!c,helperText:c}),e.jsx(E,{fullWidth:!0,label:"Description",name:"description",value:r.description,onChange:b,margin:"dense",multiline:!0,rows:3}),e.jsx(E,{select:!0,fullWidth:!0,label:"Priority",name:"priority",value:r.priority,onChange:b,margin:"dense",children:Ue.map(l=>e.jsx(xe,{value:l,children:l},l))}),e.jsx(E,{fullWidth:!0,label:"Start Date",name:"startDate",type:"date",value:r.startDate,onChange:b,margin:"dense",InputLabelProps:{shrink:!0},disabled:s==="Assigned",error:!!u,helperText:u,inputProps:{min:s==="Scheduled"?w():p()}}),e.jsx(E,{fullWidth:!0,label:"Due Date",name:"dueDate",type:"date",value:r.dueDate,onChange:b,margin:"dense",InputLabelProps:{shrink:!0},error:!!d,helperText:d,inputProps:{min:s==="Scheduled"?w():r.startDate||p()}}),e.jsx(E,{fullWidth:!0,label:"Address",name:"address",value:r.address,onChange:b,margin:"dense"})]}),e.jsxs(be,{children:[e.jsx(P,{onClick:a,color:"secondary",children:"Cancel"}),e.jsx(P,{onClick:$,variant:"contained",color:"primary",children:s==="Scheduled"?"Schedule":"Assign"})]})]})},Fe=({open:t,onClose:a,employeeObjectId:s})=>e.jsx(X,{open:t,onClose:a,maxWidth:"sm",fullWidth:!0,children:e.jsx(ze,{employeeObjectId:s,onClose:a})}),Ie=({open:t,onClose:a,loginInfo:s,loginAddress:g,logoutAddress:r})=>{var m,c,h,u;return e.jsxs(X,{open:t,onClose:a,maxWidth:"sm",fullWidth:!0,children:[e.jsx(q,{children:"Today's Login Info"}),e.jsx(H,{dividers:!0,children:s?e.jsxs(e.Fragment,{children:[e.jsxs(N,{children:[e.jsx("strong",{children:"Login Time:"})," ",new Date(s.loginTime).toLocaleString()]}),e.jsxs(N,{children:[e.jsx("strong",{children:"Logout Time:"})," ",s.logoutTime?new Date(s.logoutTime).toLocaleString():"-"]}),e.jsxs(N,{children:[e.jsx("strong",{children:"Login Location:"})," ",(m=s.loginLocation)!=null&&m.latitude&&((c=s.loginLocation)!=null&&c.longitude)?e.jsxs(e.Fragment,{children:[g||`Lat: ${s.loginLocation.latitude}, Long: ${s.loginLocation.longitude}`,e.jsx(_,{onClick:()=>{const{latitude:i,longitude:d}=s.loginLocation;window.open(`https://www.google.com/maps?q=${i},${d}`,"_blank")},size:"small",color:"primary",children:e.jsx(z,{})})]}):" -"]}),e.jsxs(N,{children:[e.jsx("strong",{children:"Logout Location:"})," ",(h=s.logoutLocation)!=null&&h.latitude&&((u=s.logoutLocation)!=null&&u.longitude)?e.jsxs(e.Fragment,{children:[r||`Lat: ${s.logoutLocation.latitude}, Long: ${s.logoutLocation.longitude}`,e.jsx(_,{onClick:()=>{const{latitude:i,longitude:d}=s.logoutLocation;window.open(`https://www.google.com/maps?q=${i},${d}`,"_blank")},size:"small",color:"secondary",children:e.jsx(z,{})})]}):" -"]})]}):e.jsx(N,{children:"No login info available."})})]})},Re="https://silitzer-pharma.onrender.com",We=({refreshEmployeesList:t,refreshFlag:a})=>{const[s,g]=n.useState(!1),[r,m]=n.useState(null),[c,h]=n.useState([]),[u,i]=n.useState(!1),[d,S]=n.useState(!1),[p,w]=n.useState(null),[b,C]=n.useState(""),[$,l]=n.useState(""),[x,k]=n.useState(""),[f,v]=n.useState(1),[F]=n.useState(10),[G,K]=n.useState(0),[Q,I]=n.useState(!1),[Y,Z]=n.useState(null),[ee,te]=n.useState(0),[se,ae]=n.useState(!0),oe=()=>g(o=>!o),R=o=>{m(o),g(!0)},ne=o=>{m(o),i(!0)},re=o=>{w(o.todayLogin),S(!0)},ie=async()=>{try{const T=await(await fetch(`${Re}/admin/employee/all?search=${x}&page=${f}&limit=${F}`,{credentials:"include"})).json();K(T.total||0);const le=T.employees.map(D=>({employeeID:D.EmployeeID||"-",name:D.username||"-",isActive:D.IsActive??!1,location:"-",task:D.task||null,employee_id:D.employee_id,employeeObjectId:D.EmployeeObjectId,todayLogin:D.todayLogin||null,lastLocation:D.liveLocation}));h(le)}catch(o){console.error("Failed to fetch employees:",o)}finally{ae(!1)}};return n.useEffect(()=>{ie()},[a,ee,x,f]),n.useEffect(()=>{v(1)},[x]),n.useEffect(()=>{C((p==null?void 0:p.loginAddress)||"Unknown"),l((p==null?void 0:p.logoutAddress)||"Unknown")},[p]),n.useEffect(()=>(M.on("updateEmployeeData",()=>{te(o=>o+1)}),()=>M.off("updateEmployeeData")),[]),se?e.jsx(V,{message:"Loading Employees..."}):e.jsxs(e.Fragment,{children:[s&&r?e.jsx(je,{EmployeeObjectId:r.employeeObjectId,EmployeeId:r.employee_id,openViewEmployee:oe,refreshEmployeesList:t}):e.jsxs("div",{className:"table",children:[e.jsx("div",{className:"table-filter",children:e.jsx("input",{type:"text",placeholder:"Search",value:x,onChange:o=>k(o.target.value)})}),e.jsx(Se,{component:fe,children:e.jsxs(ke,{children:[e.jsx(ve,{children:e.jsxs(J,{children:[e.jsx(j,{children:"Employee ID"}),e.jsx(j,{children:"Employee Name"}),e.jsx(j,{children:"Is Active"}),e.jsx(j,{children:"Location"}),e.jsx(j,{children:"Current Task"}),e.jsx(j,{children:"Today's Login"}),e.jsx(j,{children:"Assign Task For Today"})]})}),e.jsx(De,{children:c.map(o=>{var T;return e.jsxs(J,{className:o.isActive?"":"inactive-row",children:[e.jsx(j,{style:{cursor:"pointer",color:"blue",textDecoration:"underline"},onClick:()=>R(o),children:o.employeeID}),e.jsx(j,{style:{cursor:"pointer",color:"blue",textDecoration:"underline"},onClick:()=>R(o),children:o.name}),e.jsx(j,{children:e.jsx(Be,{checked:o.isActive,disabled:!0})}),e.jsx(j,{children:o.lastLocation?e.jsxs("a",{href:`https://www.google.com/maps?q=${o.lastLocation.latitude},${o.lastLocation.longitude}`,target:"_blank",rel:"noopener noreferrer",style:{color:"#555",textDecoration:"underline",display:"flex",alignItems:"center",gap:"4px"},children:[e.jsx(z,{fontSize:"small"}),(T=o.lastLocation)!=null&&T.timestamp?new Date(o.lastLocation.timestamp).toLocaleString("en-US",{weekday:"long",hour:"numeric",minute:"2-digit",hour12:!0}):"-"]}):"No location yet"}),e.jsx(j,{children:o.task?e.jsx("span",{style:{cursor:"pointer",color:"blue",textDecoration:"underline"},onClick:()=>{Z(o.task),I(!0)},children:o.task.title||"Untitled Task"}):"-"}),e.jsx(j,{children:e.jsx(P,{onClick:()=>re(o),className:"Login-Info",children:"â± Login Info"})}),e.jsx(j,{children:e.jsx(P,{variant:"contained",onClick:()=>ne(o),children:"Assign Task"})})]},o.employeeID)})})]})}),e.jsx("div",{style:{marginTop:"1rem",display:"flex",justifyContent:"center"},children:e.jsx(Ce,{count:Math.ceil(G/F),page:f,onChange:(o,T)=>v(T),color:"primary"})})]}),e.jsx(Fe,{open:u,onClose:()=>i(!1),employeeObjectId:r==null?void 0:r.employeeObjectId}),e.jsx(Ie,{open:d,onClose:()=>S(!1),loginInfo:p,loginAddress:b,logoutAddress:$}),e.jsx(we,{open:Q,onClose:()=>I(!1),task:Y})]})},Me="https://silitzer-pharma.onrender.com",_e=({openAddEmployeeForm:t,refreshEmployeesList:a})=>{const[s,g]=n.useState({EmployeeID:"",Name:"",profilePhotoUrl:"",Email:"",PhoneNumber:"",Address:"",Position:"",JoiningDate:"",UserName:"",Password:""}),[r,m]=n.useState(!1),c=u=>{const{name:i,value:d,type:S,checked:p}=u.target;g(w=>({...w,[i]:S==="checkbox"?p:d}))},h=async u=>{u.preventDefault();try{m(!0);const i=await fetch(`${Me}/admin/employee/add`,{method:"POST",headers:{"Content-Type":"application/json"},credentials:"include",body:JSON.stringify({employeeDetails:s})}),d=await i.json();i.ok?(a(),U.success("Employee added successfully!"),g({EmployeeID:"",Name:"",profilePhotoUrl:"",Email:"",PhoneNumber:"",Address:"",Position:"",JoiningDate:"",UserName:"",Password:""})):U.error("Error: "+d.error)}catch(i){U.error("Failed to add employee: "+i.message)}finally{m(!1)}};return r?e.jsx(V,{message:"Adding employee..."}):e.jsxs("div",{className:"employee-container",children:[e.jsx("h2",{className:"employee-title",children:"Add New Employee"}),e.jsxs("form",{onSubmit:h,className:"employee-form",children:[e.jsx("input",{name:"UserName",value:s.UserName,onChange:c,placeholder:"Username",className:"employee-input",required:!0}),e.jsx("input",{type:"password",name:"Password",value:s.Password,onChange:c,placeholder:"Password",className:"employee-input",required:!0}),e.jsx("input",{name:"Name",value:s.Name,onChange:c,placeholder:"Name",className:"employee-input"}),e.jsx("input",{name:"profilePhotoUrl",value:s.profilePhotoUrl,onChange:c,placeholder:"Profile Photo URL",className:"employee-input"}),e.jsx("input",{name:"Email",value:s.Email,onChange:c,placeholder:"Email",type:"email",className:"employee-input"}),e.jsx("input",{name:"PhoneNumber",value:s.PhoneNumber,onChange:c,placeholder:"Phone Number",className:"employee-input"}),e.jsx("input",{name:"Address",value:s.Address,onChange:c,placeholder:"Address",className:"employee-input"}),e.jsx("input",{name:"Position",value:s.Position,onChange:c,placeholder:"Position",className:"employee-input"}),e.jsxs("label",{className:"employee-label",children:["Joining Date:",e.jsx("input",{name:"JoiningDate",type:"date",value:s.JoiningDate,onChange:c,className:"employee-input"})]}),e.jsxs("div",{className:"employee-button-group",children:[e.jsx("button",{type:"submit",className:"employee-submit-btn",children:"Add Employee"}),e.jsx("button",{type:"button",onClick:t,className:"employee-cancel-btn",children:"Back"})]})]})]})},Je="https://silitzer-pharma.onrender.com",ut=()=>{const[t,a]=n.useState(!1),[s,g]=n.useState(!1),[r,m]=n.useState(0),c=()=>g(u=>!u),h=()=>a(u=>!u);return n.useEffect(()=>{(async()=>{try{const d=await(await fetch(`${Je}/admin/employees/data`,{method:"GET",credentials:"include"})).json();m(d.totalCount||0)}catch(i){console.error("Failed to fetch employee count",i)}})()},[s]),e.jsxs("div",{className:"page",children:[e.jsx("div",{className:"page-title",children:"Employees"}),e.jsxs("div",{className:"page-nav",children:[e.jsx("button",{className:"nav-btn",onClick:h,children:t?"View Employees":"Add New"}),e.jsxs("div",{children:["Employees Total : ",r]})]}),t?e.jsx(_e,{openAddEmployeeForm:h,refreshEmployeesList:c}):e.jsx(We,{openAddEmployeeForm:h,refreshEmployeesList:c,refreshFlag:s})]})};export{ut as default};
