import{j as e,T as ee,B as k,w as te,i as se,r as o,L as w,U as ne}from"./index-DlcvTWOH.js";import{D as re,a as ae,b as oe,c as ie}from"./DialogTitle-DGL2koDV.js";const q=({open:l,title:h="Are you sure?",content:S="Do you really want to proceed?",onConfirm:x,onCancel:p,confirmText:d="Yes",cancelText:m="No"})=>e.jsxs(re,{open:l,onClose:p,children:[e.jsx(ae,{children:h}),e.jsx(oe,{children:e.jsx(ee,{children:S})}),e.jsxs(ie,{children:[e.jsx(k,{onClick:p,color:"secondary",children:m}),e.jsx(k,{onClick:x,color:"primary",autoFocus:!0,children:d})]})]}),ue=({order:l,onBack:h,refreshProductList:S})=>{var L;const{id:x}=te(),p=se(),d=(l==null?void 0:l.id)||x,[m,j]=o.useState(!1),[F,P]=o.useState(!1),[s,g]=o.useState({}),[f,v]=o.useState(0),[y,C]=o.useState(0),[B,I]=o.useState(0),[b,J]=o.useState(0),[_,U]=o.useState(0),[i,D]=o.useState(!1),[Y,N]=o.useState(!1),[$,T]=o.useState(!1),A="https://silitzer-pharma.onrender.com",O=()=>{h?h():p(-1)};o.useEffect(()=>{if(!d)return;(async()=>{P(!0);try{const r=await(await fetch(`${A}/admin/getorder`,{method:"POST",headers:{"Content-Type":"application/json"},credentials:"include",body:JSON.stringify({id:d})})).json();g(r)}catch(n){console.error("Error fetching pending orders:",n)}finally{P(!1)}})()},[d]),o.useEffect(()=>{var t;if((t=s==null?void 0:s.products_list)!=null&&t.length){const n=s.products_list.reduce((u,c)=>u+(c.itemRate||0)*(c.quantity||1),0),r=s.products_list.reduce((u,c)=>u+(c.purchaseRate||0)*(c.quantity||1),0),a=s.products_list.reduce((u,c)=>{const G=c.quantity||1,H=(c.itemRate||0)*G,K=(c.taxes||[]).reduce((V,X)=>{const Z=X.rate||0;return V+H*Z/100},0);return u+K},0);C(n),v(r),I(a)}else C(0),v(0),I(0)},[s.products_list]);const R=(t,n,r)=>{const a=[...s.products_list];a[t][n]=parseFloat(r)||0,g({...s,products_list:a})},z=t=>{const n=[...s.products_list];n.splice(t,1),g({...s,products_list:n})},E=async()=>{const t=Array.isArray(s.products_list)?s.products_list.map(r=>({productId:r.productId,quantity:r.quantity,itemRate:r.itemRate,purchaseRate:r.purchaseRate})):[],n={orderId:s.id,productList:t,subtotal:y,totalPurchaseCost:f,netAmount:Number(b),receivedAmount:_};j(!0);try{await fetch(`${A}/admin/approveorder`,{method:"POST",headers:{"Content-Type":"application/json"},credentials:"include",body:JSON.stringify(n)}),j(!1),O()}catch(r){console.error("Error approving order:",r),j(!1)}},M=()=>{var t;(t=document.activeElement)==null||t.blur(),b?E():N(!0)},Q=()=>{T(!0)},W=async()=>{T(!1);try{await fetch(`${A}/admin/updateorderstatus`,{method:"PUT",headers:{"Content-Type":"application/json"},credentials:"include",body:JSON.stringify({orderId:s.id,status:"Cancelled"})}),alert("Order cancelled"),O()}catch(t){console.error("Error cancelling order:",t)}};return m?e.jsx(w,{message:"Please wait, approving order..."}):F?e.jsx(w,{message:"Loading Order Details..."}):e.jsxs("div",{className:"approve-order",children:[e.jsx("div",{className:"top",children:e.jsx("button",{onClick:O,children:e.jsx(ne,{sx:{fontSize:30}})})}),e.jsx("div",{className:"title",children:"Approve Order"}),e.jsxs("div",{className:"approve-order-details",children:[e.jsxs("div",{className:"det-1",children:[e.jsxs("div",{children:[e.jsx("span",{children:"Order Number:"})," ",s.orderNumber]}),e.jsxs("div",{children:[e.jsx("span",{children:"Distributor:"})," ",s.distributorName]}),e.jsxs("div",{children:[e.jsx("span",{children:"Order Date:"})," ",new Date(s.orderDate).toLocaleString()]})]}),e.jsxs("div",{className:"product-list",children:[e.jsx("h3",{children:"Product List"}),e.jsxs("table",{className:"product-table",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{children:"Product Name"}),e.jsx("th",{children:"Quantity"}),e.jsx("th",{children:"Item Rate (₹)"}),e.jsx("th",{children:"Purchase Rate (₹)"}),e.jsx("th",{children:"Stock"}),e.jsx("th",{children:"Taxes"}),i&&e.jsx("th",{children:"Action"})]})}),e.jsx("tbody",{children:(L=s.products_list)==null?void 0:L.map((t,n)=>{var r;return e.jsxs("tr",{children:[e.jsx("td",{children:t.productName}),e.jsx("td",{children:e.jsx("input",{className:"input-field",type:"number",value:t.quantity,onChange:a=>R(n,"quantity",a.target.value),min:"0",disabled:!i})}),e.jsx("td",{children:e.jsx("input",{className:"input-field",type:"number",value:t.itemRate,onChange:a=>R(n,"itemRate",a.target.value),min:"0",disabled:!i})}),e.jsx("td",{children:e.jsx("input",{className:"input-field",type:"number",value:t.purchaseRate,onChange:a=>R(n,"purchaseRate",a.target.value),min:"0",disabled:!i})}),e.jsx("td",{children:t.stock??0}),e.jsx("td",{children:((r=t.taxes)==null?void 0:r.length)>0?e.jsx("ul",{children:t.taxes.map(a=>e.jsxs("li",{children:[a.name," - ",a.rate,"%"]},a._id))}):"No Taxes"}),i&&e.jsx("td",{children:e.jsx("button",{className:"remove-btn",onClick:()=>z(n),children:"Remove"})})]},t.productId)})}),e.jsx("tfoot",{children:e.jsxs("tr",{children:[e.jsx("td",{colSpan:2,children:e.jsx("strong",{children:"Total"})}),e.jsx("td",{children:e.jsxs("strong",{children:["₹",y.toFixed(2)]})}),e.jsx("td",{children:e.jsxs("strong",{children:["₹",f.toFixed(2)]})}),e.jsx("td",{}),e.jsx("td",{children:e.jsxs("strong",{children:["₹",B.toFixed(2)]})}),i&&e.jsx("td",{})]})})]})]}),e.jsxs("div",{className:"Amount",children:[e.jsxs("span",{children:[e.jsx("strong",{children:"Subtotal:"}),e.jsx("input",{type:"number",value:y,onChange:t=>C(parseFloat(t.target.value)||0),disabled:!i})]}),e.jsxs("span",{children:[e.jsx("strong",{children:"Total Purchase Cost:"}),e.jsx("input",{type:"number",value:f,onChange:t=>v(parseFloat(t.target.value)||0),disabled:!i})]}),e.jsxs("span",{children:[e.jsx("strong",{children:"Net Amount:"}),e.jsx("input",{type:"number",value:b,onChange:t=>J(t.target.value)})]}),e.jsxs("span",{children:[e.jsx("strong",{children:"Received Amount:"}),e.jsx("input",{type:"number",value:_,onChange:t=>U(t.target.value)})]})]})]}),e.jsx("div",{className:"approve-order-fun-btn",children:i?e.jsx("button",{className:"save",onClick:()=>D(!1),children:"Save"}):e.jsxs(e.Fragment,{children:[e.jsx("button",{className:"approve",onClick:M,children:"Approve"}),e.jsx("button",{className:"edit",onClick:()=>D(!0),children:"Edit"}),e.jsx("button",{className:"cancel",onClick:Q,children:"Cancel Order"})]})}),s.orderInstructions&&e.jsxs("div",{className:"orderInstructions",children:[e.jsx("div",{children:"Order Instructions"}),e.jsx("p",{children:s.orderInstructions})]}),e.jsx(q,{open:Y,title:"Net Amount Missing",content:"Net Amount is empty. Are you sure you want to continue?",onCancel:()=>N(!1),onConfirm:()=>{N(!1),E()},cancelText:"Cancel",confirmText:"Yes, Proceed"}),e.jsx(q,{open:$,title:"Cancel Order",content:"Are you sure you want to cancel the Order?",onCancel:()=>T(!1),onConfirm:W,cancelText:"No",confirmText:"Yes, Cancel"})]})};export{ue as default};
