import{r as n,i as fe,E as R,j as e,L as Pe,P as Ce,B as u,X as i}from"./index-DlcvTWOH.js";/* empty css              */import{F as ve}from"./FormControlLabel-BjTYelCt.js";import{C as ye}from"./Checkbox-COSfp9Jj.js";import{T as be}from"./TableContainer-CQmYnS7h.js";import{T as Oe,a as De,b as E,c as l,d as Te}from"./TableRow-DuThesGT.js";import{T as ke}from"./TableSortLabel-Csm9lG0A.js";import{T as we}from"./TablePagination-C03NsVHS.js";import{D as j,a as S,b as f,c as P}from"./DialogTitle-DGL2koDV.js";import{F as H,I as V}from"./InputLabel-Bd8_Eb26.js";import{S as B}from"./Select-BpVlYiRl.js";import"./useFormControl-CXPDb4oN.js";import"./SwitchBase--2o_48n6.js";import"./useControlled-CHhDBfC_.js";import"./LastPage-DpFt_x2b.js";import"./IconButton-eRt6TsSc.js";const w="https://silitzer-pharma.onrender.com",_e=({refreshFlag:Le})=>{const[_,q]=n.useState([]),[J,M]=n.useState(0),[p,W]=n.useState(null),[o,z]=n.useState(null),[C,d]=n.useState(0),[v,G]=n.useState(10),[K,y]=n.useState(!1),[Q,g]=n.useState(!1),[X,m]=n.useState(!1),[x,L]=n.useState(""),[U,N]=n.useState(""),[b,Y]=n.useState("All"),[O,Z]=n.useState(""),[ee,te]=n.useState(0),[$,c]=n.useState({open:!1,message:""}),[D,se]=n.useState(""),[T,ae]=n.useState(!1),[ne,A]=n.useState(!1),[h,k]=n.useState(null),re=fe(),ie=["Processing","Shipped","Delivered","Hold"].includes(x)?x:"",le=t=>{Y(t.target.value),d(0)};n.useEffect(()=>{(async()=>{try{A(!0);const s=await(await fetch(`${w}/admin/getallorders?page=${C}&limit=${v}&view=${b}&search=${encodeURIComponent(O)}&filterDate=${D}&showPending=${T}`,{credentials:"include"})).json();q(s.orders),M(s.totalCount)}catch(a){console.error("Error fetching orders:",a)}finally{A(!1)}})()},[ee,b,C,v,O,D,T]),n.useEffect(()=>(R.on("orderUpdated",()=>{te(t=>t+1)}),()=>{R.off("orderUpdated")}),[]);const oe=t=>{W(o===t&&p==="asc"?"desc":"asc"),z(t)},de=(t,a)=>d(a),ce=t=>{G(parseInt(t.target.value,10)),d(0)},F=(t,a,s)=>a[s]<t[s]?-1:a[s]>t[s]?1:0,ue=p&&o?((t,a)=>[...t].map((s,r)=>({el:s,index:r})).sort((s,r)=>{const I=a(s.el,r.el);return I!==0?I:s.index-r.index}).map(({el:s})=>s))(_,((t,a)=>t==="desc"?(s,r)=>F(s,r,a):(s,r)=>-F(s,r,a))(p,o)):_,pe=[{id:"order_id",label:"Order ID"},{id:"Distributor",label:"Distributor"},{id:"order_date",label:"Order Date"},{id:"order_status",label:"Order Status"},{id:"payment_status",label:"Payment Status"},{id:"products_list",label:"Products"}],he=t=>{re(`/admin/order/${t.id}`)},ge=t=>{k(t),y(!0)},me=t=>{k(t),L(t.order_status),g(!0)},xe=t=>{k(t),N(t.payment_status),m(!0)},je=async()=>{try{const a=(await fetch(`${w}/admin/updateorderstatus`,{method:"PUT",headers:{"Content-Type":"application/json"},credentials:"include",body:JSON.stringify({orderId:h.id,status:x})})).ok?"Order status updated":"Failed to update order status";c({open:!0,message:a})}catch{c({open:!0,message:"Failed to update order. Try again."})}g(!1)},Se=async()=>{try{const a=(await fetch(`${w}/admin/updateorderpaymentstatus`,{method:"PUT",headers:{"Content-Type":"application/json"},credentials:"include",body:JSON.stringify({orderId:h.id,paymentStatus:U})})).ok?"Payment status updated":"Failed to update payment status";c({open:!0,message:a})}catch{c({open:!0,message:"Failed to update payment. Try again."})}m(!1)};return ne?e.jsx(Pe,{message:"Loading Orders..."}):e.jsxs("div",{className:"table",children:[e.jsxs("div",{className:"table-filter",children:[e.jsxs("div",{className:"filter-orders",children:[e.jsx("label",{children:"View Orders: "}),e.jsx("input",{type:"date",value:D,onChange:t=>{se(t.target.value),d(0)}}),e.jsxs("select",{value:b,onChange:le,children:[e.jsx("option",{value:"All",children:"All"}),e.jsx("option",{value:"Pending",children:"Pending"}),e.jsx("option",{value:"Approved",children:"Approved"}),e.jsx("option",{value:"Processing",children:"Processing"}),e.jsx("option",{value:"Shipped",children:"Shipped"}),e.jsx("option",{value:"Delivered",children:"Delivered"}),e.jsx("option",{value:"Cancelled",children:"Cancelled"}),e.jsx("option",{value:"Hold",children:"Hold"})]})]}),e.jsx("input",{type:"text",placeholder:"Search by Distributor, Order ID, Product...",value:O,onChange:t=>{Z(t.target.value),d(0)}}),e.jsx(ve,{control:e.jsx(ye,{checked:T,onChange:t=>{ae(t.target.checked),d(0)},color:"primary"}),label:"Pending Orders"})]}),e.jsxs(be,{component:Ce,className:"table-container",children:[e.jsxs(Oe,{children:[e.jsx(De,{children:e.jsx(E,{children:pe.map(t=>e.jsx(l,{align:"center",sortDirection:o===t.id?p:!1,children:e.jsx(ke,{active:o===t.id,direction:o===t.id?p:"asc",onClick:()=>oe(t.id),children:t.label})},t.id))})}),e.jsx(Te,{children:ue.map(t=>{var r;const a=(r=t.order_status)==null?void 0:r.toLowerCase(),s=!["pending","cancel","cancelled","canceled"].includes(a);return e.jsxs(E,{children:[e.jsx(l,{align:"center",style:{cursor:"pointer",color:"blue",textDecoration:"underline"},onClick:()=>he(t),children:t.order_id}),e.jsx(l,{align:"center",children:t.Distributor}),e.jsx(l,{align:"center",children:new Date(t.order_date).toLocaleString("en-GB",{year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit"})}),e.jsx(l,{align:"center",className:`order-status ${t.order_status}`,onClick:()=>{s&&me(t)},style:{cursor:s?"pointer":"default",color:s?"inherit":"gray"},children:t.order_status}),e.jsx(l,{align:"center",className:`payment-status ${t.payment_status}`,onClick:()=>xe(t),children:t.payment_status}),e.jsx(l,{align:"center",onClick:()=>ge(t),style:{cursor:"pointer",color:"#0077cc"},children:"Products"})]},t.order_id)})})]}),e.jsx(we,{component:"div",count:J,page:C,onPageChange:de,rowsPerPage:v,onRowsPerPageChange:ce,rowsPerPageOptions:[5,10,25,50]})]}),e.jsxs(j,{open:K,onClose:()=>y(!1),children:[e.jsx(S,{children:"Product List"}),e.jsx(f,{children:((h==null?void 0:h.products_list)||[]).map((t,a)=>e.jsxs("div",{children:[e.jsx("strong",{children:t.product_name})," - Quantity: ",t.quantity]},a))}),e.jsx(P,{children:e.jsx(u,{onClick:()=>y(!1),children:"Close"})})]}),e.jsxs(j,{open:Q,onClose:()=>g(!1),children:[e.jsx(S,{children:"Update Order Status"}),e.jsx(f,{children:e.jsxs(H,{fullWidth:!0,children:[e.jsx(V,{children:"Order Status"}),e.jsxs(B,{value:ie,onChange:t=>L(t.target.value),children:[e.jsx(i,{value:"Processing",children:"Processing"}),e.jsx(i,{value:"Shipped",children:"Shipped"}),e.jsx(i,{value:"Delivered",children:"Delivered"}),e.jsx(i,{value:"Hold",children:"Hold"})]})]})}),e.jsxs(P,{children:[e.jsx(u,{onClick:je,disabled:!x,children:"Update"}),e.jsx(u,{onClick:()=>g(!1),children:"Cancel"})]})]}),e.jsxs(j,{open:X,onClose:()=>m(!1),children:[e.jsx(S,{children:"Update Payment Status"}),e.jsx(f,{children:e.jsxs(H,{fullWidth:!0,children:[e.jsx(V,{children:"Payment Status"}),e.jsxs(B,{value:U,onChange:t=>N(t.target.value),children:[e.jsx(i,{value:"Pending",children:"Pending"}),e.jsx(i,{value:"Partially Paid",children:"Partially Paid"}),e.jsx(i,{value:"Completed",children:"Completed"})]})]})}),e.jsxs(P,{children:[e.jsx(u,{onClick:Se,children:"Update"}),e.jsx(u,{onClick:()=>m(!1),children:"Cancel"})]})]}),e.jsxs(j,{open:$.open,onClose:()=>c({open:!1,message:""}),children:[e.jsx(S,{children:"Notification"}),e.jsx(f,{children:$.message}),e.jsx(P,{children:e.jsx(u,{onClick:()=>c({open:!1,message:""}),children:"OK"})})]})]})},Xe=()=>e.jsxs("div",{className:"page",children:[e.jsx("div",{className:"page-title",children:"Orders"}),e.jsx("div",{className:"orders-table",children:e.jsx(_e,{})})]});export{Xe as default};
